<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Moultrie Mobile ‚Äì Career Match</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <style>
    :root {
      --mm-green: #1e3d12;
      --mm-green-soft: #2d5a1a;
      --mm-green-block: #274e16;
      --mm-yellow: #e8c547;
      --mm-yellow-bright: #f5d84d;
      --mm-yellow-dark: #c9a83a;
      --mm-bg: #f6f4ee;
      --mm-bg-warm: #faf8f2;
      --mm-card: #fff;
      --mm-card-soft: #fdfcfa;
      --mm-text: #1c1c1c;
      --mm-muted: #5c5c5c;
      --mm-border: rgba(30,61,18,0.12);
      --radius: 12px;
      --radius-sm: 8px;
      --shadow: 0 2px 12px rgba(30,61,18,0.06);
      --shadow-hover: 0 8px 28px rgba(30,61,18,0.12);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: var(--mm-text);
      background: var(--mm-bg);
      line-height: 1.5;
    }
    .site-header {
      background: var(--mm-green);
      color: white;
      padding: 0.875rem 1.5rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 1rem;
      box-shadow: 0 2px 16px rgba(0,0,0,0.08);
    }
    .site-logo {
      font-weight: 700;
      font-size: 1.25rem;
      letter-spacing: 0.02em;
    }
    .site-logo span { color: var(--mm-yellow-bright); }
    .main-nav {
      display: flex;
      gap: 0.25rem;
      flex-wrap: wrap;
    }
    .main-nav a {
      color: rgba(255,255,255,0.92);
      text-decoration: none;
      padding: 0.5rem 1rem;
      border-radius: 999px;
      font-size: 0.9rem;
      font-weight: 500;
      transition: background 0.2s, color 0.2s;
    }
    .main-nav a:hover {
      background: rgba(255,255,255,0.12);
      color: white;
    }
    .main-nav a.active {
      background: var(--mm-yellow-bright);
      color: var(--mm-green);
    }
    .main-nav a.active:hover {
      background: var(--mm-yellow);
      color: var(--mm-green);
    }
    main {
      max-width: 1280px;
      margin: 0 auto;
      padding: 2.5rem 2rem;
    }
    .hero {
      position: relative;
      min-height: 320px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 4rem 1.5rem;
      border-radius: var(--radius);
      overflow: hidden;
      margin-bottom: 2rem;
      box-shadow: var(--shadow-hover);
    }
    .hero-bg {
      position: absolute;
      inset: 0;
      background: var(--mm-green) url('https://images.unsplash.com/photo-1441974231531-c6227db76b6e?w=1920&q=90') center/cover no-repeat;
    }
    .hero-bg::after {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, rgba(30,61,18,0.82) 0%, rgba(30,61,18,0.72) 50%, rgba(30,61,18,0.88) 100%);
    }
    .hero h1, .hero p { position: relative; z-index: 1; }
    .hero h1 {
      margin: 0 0 0.75rem;
      font-size: 2.5rem;
      font-weight: 800;
      letter-spacing: -0.02em;
      color: #fff;
      text-shadow: 0 2px 20px rgba(0,0,0,0.2);
    }
    .hero p {
      margin: 0;
      color: rgba(255,255,255,0.9);
      font-size: 1.15rem;
      font-weight: 500;
      max-width: 28em;
      text-shadow: 0 1px 8px rgba(0,0,0,0.15);
    }
    .view-section { display: none; }
    .view-section.active { display: block; }
    .option-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 1rem;
      margin-top: 1.5rem;
    }
    .option-card {
      background: #e8f0e4;
      border: 3px solid var(--mm-green);
      padding: 1.25rem 1.5rem;
      border-radius: var(--radius);
      text-decoration: none;
      color: var(--mm-text);
      font-weight: 600;
      box-shadow: var(--shadow);
      transition: box-shadow 0.2s, transform 0.2s, border-color 0.2s;
    }
    .option-card:hover {
      background: #dcead8;
      box-shadow: var(--shadow-hover);
      transform: translateY(-2px);
      border-color: var(--mm-green-block);
      color: var(--mm-green);
    }
    .view-title {
      font-size: 1.2rem;
      color: var(--mm-green);
      margin: 0 0 0.75rem;
      font-weight: 700;
      letter-spacing: -0.01em;
    }
    #employee .employee-section-header {
      margin-bottom: 1.25rem;
    }
    #employee .employee-section-title {
      font-size: 1.35rem;
      font-weight: 700;
      color: var(--mm-green);
      margin: 0 0 0.5rem;
    }
    #employee .employee-section-tagline {
      font-size: 1rem;
      color: var(--mm-muted);
      margin: 0;
      line-height: 1.5;
    }
    #employee .employee-section-intro {
      margin-bottom: 1.5rem;
      padding: 1.25rem 1.5rem;
      background: var(--mm-card);
      border: 1px solid var(--mm-border);
      border-radius: var(--radius);
      font-size: 1rem;
      line-height: 1.65;
      color: var(--mm-text);
    }
    #employee .option-grid {
      gap: 1.5rem;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      align-items: stretch;
    }
    #employee .option-card {
      padding: 2.25rem 2rem;
      min-height: 140px;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      font-size: 1.05rem;
      border: 3px solid var(--mm-green);
      background: #e8f0e4;
      box-shadow: var(--shadow);
    }
    #employee .option-card:hover {
      border-color: var(--mm-green-block);
      background: #dcead8;
      box-shadow: var(--shadow-hover);
      transform: translateY(-2px);
    }

    @media (max-width: 980px) {
      #employee .option-grid { grid-template-columns: repeat(2, minmax(0, 1fr)); }
    }
    @media (max-width: 620px) {
      #employee .option-grid { grid-template-columns: 1fr; }
      #employee .option-card { min-height: 120px; padding: 2rem 1.5rem; }
    }
    .employer-placeholder {
      background: var(--mm-card-soft);
      border: 1px solid var(--mm-border);
      padding: 2rem;
      border-radius: var(--radius);
      color: var(--mm-muted);
      box-shadow: var(--shadow);
    }
    .intro { margin-top: 0; }
    .intro p { margin: 0 0 1rem; line-height: 1.65; color: var(--mm-text); }
    .intro p:last-child { margin-bottom: 0; }
    .intro-lead { font-size: 1.1rem; font-weight: 500; }
    .intro-blocks {
      display: grid;
      gap: 1rem;
      margin-top: 1.5rem;
    }
    .intro-block {
      background: var(--mm-card);
      border: 1px solid var(--mm-border);
      padding: 1.5rem 1.75rem;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }
    .intro-block h3 {
      margin: 0 0 0.5rem;
      font-size: 1rem;
      color: var(--mm-green);
      font-weight: 700;
    }
    .intro-block p { margin: 0; font-size: 0.95rem; color: var(--mm-muted); }
    .intro-cta {
      margin-top: 1.75rem;
      padding: 1.125rem 1.5rem;
      background: var(--mm-green);
      color: var(--mm-yellow-bright);
      font-weight: 700;
      text-align: center;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      border: none;
    }
    .intro-cta,
    .intro-cta * { color: var(--mm-yellow-bright) !important; }
    .nature-strip {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0;
      margin: 2rem 0;
      overflow: hidden;
      border-radius: var(--radius);
      box-shadow: var(--shadow-hover);
    }
    .nature-strip img {
      width: 100%;
      height: 340px;
      object-fit: cover;
      object-position: center;
      display: block;
    }
    .intro .warm { font-size: 1.05rem; line-height: 1.7; color: var(--mm-text); }
    .back-link {
      display: inline-block;
      margin-bottom: 1rem;
      color: var(--mm-green);
      font-weight: 600;
      text-decoration: none;
      font-size: 0.95rem;
    }
    .back-link:hover { color: var(--mm-green-block); text-decoration: underline; }
    /* Personalized Questions */
    .personalized-section {
      margin-top: 2.5rem;
      padding-top: 2rem;
      border-top: 3px solid var(--mm-green);
    }
    .personalized-section h3 {
      color: var(--mm-green);
      font-size: 1.2rem;
      margin: 0 0 1.5rem;
      font-weight: 800;
    }
    .question-block {
      background: var(--mm-card);
      border: 3px solid var(--mm-green);
      padding: 1.25rem 1.5rem;
      margin-bottom: 1.25rem;
    }
    .question-block label {
      display: block;
      font-weight: 700;
      color: var(--mm-text);
      margin-bottom: 0.5rem;
      font-size: 0.95rem;
    }
    .question-block .hint {
      font-size: 0.85rem;
      color: var(--mm-muted);
      font-weight: 400;
      margin-bottom: 0.5rem;
    }
    .question-block input[type="text"],
    .question-block input[type="email"],
    .question-block select,
    .question-block textarea {
      width: 100%;
      padding: 0.6rem 0.75rem;
      border: 2px solid var(--mm-green);
      font-family: inherit;
      font-size: 1rem;
      background: var(--mm-bg);
    }
    .question-block textarea {
      min-height: 100px;
      resize: vertical;
    }
    .question-block input:focus,
    .question-block select:focus,
    .question-block textarea:focus {
      outline: none;
      border-color: var(--mm-yellow-dark);
      box-shadow: 0 0 0 2px var(--mm-yellow);
    }
    .choice-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem 1.5rem;
      margin-top: 0.5rem;
    }
    .choice-row label {
      display: flex;
      align-items: center;
      gap: 0.4rem;
      margin-bottom: 0;
      font-weight: 600;
      cursor: pointer;
    }
    .choice-row input[type="checkbox"],
    .choice-row input[type="radio"] {
      width: 1.1em;
      height: 1.1em;
      accent-color: var(--mm-green);
      flex-shrink: 0;
      cursor: pointer;
    }
    .choice-row.sector-chips label {
      padding: 0.5rem 1rem;
      border: 2px solid var(--mm-green);
      border-radius: var(--radius-sm);
      transition: background 0.2s, color 0.2s;
    }
    .choice-row.sector-chips label:has(input:checked) {
      background: var(--mm-green);
      color: var(--mm-yellow-bright);
    }
    .choice-row.sector-chips label:hover {
      background: #e8f0e4;
    }
    .choice-row.sector-chips label:has(input:checked):hover {
      background: var(--mm-green-block);
    }
    .role-selector {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 1.25rem;
      margin: 1.5rem 0;
    }
    .role-card {
      display: block;
      background: #e8f0e4;
      border: 3px solid var(--mm-green);
      padding: 1.25rem 1.5rem;
      text-decoration: none;
      color: var(--mm-text);
      font-weight: 600;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      transition: box-shadow 0.2s, transform 0.2s, border-color 0.2s;
    }
    .role-card h2 {
      margin: 0 0 0.4rem;
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--mm-green);
    }
    .role-card p {
      margin: 0;
      font-size: 0.95rem;
      color: var(--mm-muted);
    }
    .role-card:hover {
      background: #dcead8;
      box-shadow: var(--shadow-hover);
      transform: translateY(-2px);
      border-color: var(--mm-green-block);
      color: var(--mm-green);
    }
    .role-card:hover h2 { color: var(--mm-green-block); }

    /* Chatbot */
    .chat-toggle {
      position: fixed;
      bottom: 1.5rem;
      right: 1.5rem;
      width: 3.25rem;
      height: 3.25rem;
      border-radius: 50%;
      background: var(--mm-green);
      color: var(--mm-yellow-bright);
      font-size: 1.2rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: var(--shadow-hover);
      z-index: 1000;
      border: none;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .chat-toggle:hover {
      transform: scale(1.06);
      box-shadow: 0 10px 32px rgba(30,61,18,0.2);
    }
    .chat-panel {
      display: none;
      position: fixed;
      bottom: 5rem;
      right: 1.5rem;
      width: 340px;
      max-width: calc(100vw - 3rem);
      height: 440px;
      background: var(--mm-card);
      border: 1px solid var(--mm-border);
      border-radius: var(--radius);
      flex-direction: column;
      z-index: 1001;
      box-shadow: var(--shadow-hover);
    }
    .chat-panel.open { display: flex; }
    .chat-header {
      padding: 0.875rem 1.25rem;
      background: var(--mm-green);
      color: var(--mm-yellow-bright);
      font-weight: 600;
      font-size: 0.95rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-radius: var(--radius) var(--radius) 0 0;
    }
    .chat-close {
      background: none;
      border: none;
      color: var(--mm-yellow-bright);
      font-size: 1.25rem;
      cursor: pointer;
      padding: 0 0.25rem;
      line-height: 1;
      opacity: 0.9;
    }
    .chat-close:hover { opacity: 1; }
    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 1rem;
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }
    .chat-msg {
      max-width: 85%;
      padding: 0.65rem 1rem;
      font-size: 0.9rem;
      line-height: 1.45;
      border-radius: var(--radius-sm);
    }
    .chat-msg.bot {
      align-self: flex-start;
      background: var(--mm-bg-warm);
      border: 1px solid var(--mm-border);
      color: var(--mm-text);
    }
    .chat-msg.user {
      align-self: flex-end;
      background: var(--mm-green);
      color: var(--mm-yellow-bright);
    }
    .chat-input-wrap {
      padding: 0.875rem;
      border-top: 1px solid var(--mm-border);
      display: flex;
      gap: 0.5rem;
    }
    .chat-input-wrap input {
      flex: 1;
      padding: 0.6rem 0.9rem;
      border: 1px solid var(--mm-border);
      border-radius: var(--radius-sm);
      font-size: 0.9rem;
      font-family: inherit;
    }
    .chat-input-wrap input:focus {
      outline: none;
      border-color: var(--mm-green-soft);
      box-shadow: 0 0 0 2px rgba(45,90,26,0.15);
    }
    .chat-input-wrap button {
      padding: 0.6rem 1rem;
      background: #e8f0e4;
      color: var(--mm-green);
      border: 2px solid var(--mm-green);
      border-radius: var(--radius-sm);
      font-weight: 600;
      font-size: 0.9rem;
      cursor: pointer;
      font-family: inherit;
      transition: background 0.2s;
    }
    .chat-input-wrap button:hover { background: #dcead8; }

    .upload-resume-block { border-radius: var(--radius); }
    .upload-resume-btn {
      padding: 0.75rem 1.5rem;
      background: #e8f0e4;
      color: var(--mm-green);
      border: 3px solid var(--mm-green);
      border-radius: var(--radius-sm);
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      font-family: inherit;
      box-shadow: var(--shadow);
      transition: background 0.2s, transform 0.2s, box-shadow 0.2s;
    }
    .upload-resume-btn:hover {
      background: #dcead8;
      transform: translateY(-1px);
      box-shadow: var(--shadow-hover);
    }

    /* Upload Resume section */
    #upload-resume .intro { margin-bottom: 1.5rem; }
    #upload-resume .upload-resume-block {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
      padding: 2rem 1.75rem;
    }
    .match-by-box {
      padding: 1.25rem 1.5rem;
      background: rgba(35, 67, 23, 0.06);
      border: 2px dashed var(--mm-green);
      border-radius: 8px;
    }
    .match-by-box h3 {
      margin: 0 0 0.75rem;
      font-size: 1rem;
      color: var(--mm-green);
      font-weight: 800;
    }
    .match-by-options {
      display: flex;
      gap: 1.5rem;
      flex-wrap: wrap;
      margin-bottom: 0.5rem;
    }
    .match-by-options label {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      cursor: pointer;
      font-weight: 600;
      color: var(--mm-text);
    }
    .match-by-options input[type="radio"] {
      width: 1.1em;
      height: 1.1em;
      accent-color: var(--mm-green);
    }
    .personalized-submit {
      margin-top: 1.5rem;
      padding: 0.9rem 1.5rem;
      background: var(--mm-green);
      color: var(--mm-yellow);
      border: none;
      font-weight: 700;
      font-size: 1rem;
      cursor: pointer;
      font-family: inherit;
    }
    .personalized-submit:hover {
      background: var(--mm-green-block);
    }
    .match-by-box p {
      margin: 0.5rem 0 0;
      font-size: 0.85rem;
      color: var(--mm-muted);
      line-height: 1.5;
    }
    .upload-zone {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 160px;
      padding: 2rem;
      background: var(--mm-bg);
      border: 2px dashed var(--mm-green);
      border-radius: 8px;
      transition: background 0.2s, border-color 0.2s;
    }
    .upload-zone:hover, .upload-zone:focus-within {
      background: rgba(35, 67, 23, 0.05);
      border-color: var(--mm-green-block);
    }
    .upload-resume-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      padding: 0.9rem 1.75rem;
      background: var(--mm-green);
      color: var(--mm-yellow);
      border: none;
      font-size: 1rem;
      font-weight: 700;
      cursor: pointer;
      border-radius: 8px;
      transition: background 0.2s, transform 0.1s;
      font-family: inherit;
    }
    .upload-resume-btn:hover {
      background: var(--mm-green-block);
      transform: translateY(-1px);
    }
    .upload-zone .upload-hint {
      margin-top: 0.75rem;
      font-size: 0.9rem;
      color: var(--mm-muted);
    }
    .resume-file-name {
      margin: 0.75rem 0 0;
      font-size: 0.9rem;
      color: var(--mm-green);
      font-weight: 600;
    }
    .resume-file-name:empty { display: none; }
    .resume-scan-status {
      margin-top: 0.5rem;
      font-size: 0.95rem;
      color: var(--mm-muted);
      min-height: 1.5em;
    }
    .resume-scan-results {
      margin-top: 1rem;
      padding: 1.25rem;
      background: rgba(35, 67, 23, 0.05);
      border-radius: 8px;
      border: 1px solid rgba(35, 67, 23, 0.2);
    }
    .resume-scan-results h3 {
      margin: 0 0 0.75rem;
      font-size: 1rem;
      color: var(--mm-green);
      font-weight: 800;
    }
    .resume-section-list {
      list-style: none;
      margin: 0;
      padding: 0;
      display: grid;
      gap: 0.5rem;
    }
    .resume-section-list li {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.9rem;
    }
    .resume-section-list li .section-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      flex-shrink: 0;
    }
    .resume-section-list li.found .section-dot { background: var(--mm-green); }
    .resume-section-list li.missing .section-dot { background: var(--mm-muted); opacity: 0.6; }
    .job-matches-wrap {
      margin-top: 1.5rem;
      padding-top: 1.5rem;
      border-top: 2px solid var(--mm-green);
    }
    .job-matches-wrap h3 {
      margin: 0 0 1rem;
      font-size: 1.1rem;
      color: var(--mm-green);
      font-weight: 800;
    }
    .job-matches-list {
      list-style: none;
      margin: 0 0 1.25rem 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }
    .job-matches-list:last-of-type { margin-bottom: 0; }
    .job-matches-list li {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 0.5rem 1rem;
      padding: 0.85rem 1rem;
      background: var(--mm-bg);
      border: 1px solid rgba(35, 67, 23, 0.2);
      border-radius: 8px;
    }
    .job-matches-list li .job-title-link {
      color: var(--mm-green);
      font-weight: 700;
      text-decoration: none;
      flex: 1 1 auto;
    }
    .job-matches-list li .job-title-link:hover { text-decoration: underline; }
    .job-matches-list li .job-pct {
      font-size: 0.9rem;
      font-weight: 700;
      color: var(--mm-green);
    }
    .job-matches-list li .job-like-btn {
      padding: 0.35rem 0.65rem;
      font-size: 0.85rem;
      font-weight: 600;
      border: 2px solid var(--mm-green);
      background: transparent;
      color: var(--mm-green);
      border-radius: 6px;
      cursor: pointer;
      font-family: inherit;
    }
    .job-matches-list li .job-like-btn:hover { background: rgba(35, 67, 23, 0.1); }
    .job-matches-list li .job-like-btn.liked {
      background: var(--mm-green);
      color: var(--mm-yellow);
    }
    .job-matches-list li .job-meta {
      width: 100%;
      font-size: 0.85rem;
      color: var(--mm-muted);
      margin-top: 0.15rem;
    }
    .course-card {
      background: var(--mm-card);
      border: 1px solid var(--mm-border);
      border-radius: var(--radius);
      padding: 1.25rem;
      box-shadow: var(--shadow);
      transition: box-shadow 0.2s, transform 0.2s;
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }
    .course-card:hover {
      box-shadow: var(--shadow-hover);
      transform: translateY(-2px);
    }
    .course-title {
      font-size: 1.05rem;
      font-weight: 700;
      color: var(--mm-green);
      margin: 0;
      line-height: 1.3;
    }
    .course-provider {
      font-size: 0.85rem;
      color: var(--mm-muted);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    .course-skill {
      display: inline-block;
      background: #e8f0e4;
      color: var(--mm-green);
      padding: 0.25rem 0.6rem;
      border-radius: 999px;
      font-size: 0.8rem;
      font-weight: 600;
      margin-right: 0.4rem;
      margin-bottom: 0.4rem;
    }
    .course-meta {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      font-size: 0.85rem;
      color: var(--mm-muted);
      margin-top: 0.25rem;
    }
    .course-meta span {
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }
    .course-link {
      margin-top: 0.5rem;
      padding: 0.6rem 1rem;
      background: #e8f0e4;
      color: var(--mm-green);
      border: 2px solid var(--mm-green);
      border-radius: var(--radius-sm);
      text-decoration: none;
      font-weight: 600;
      font-size: 0.9rem;
      text-align: center;
      display: block;
      transition: background 0.2s;
    }
    .course-link:hover {
      background: #dcead8;
    }
    .difficulty-badge {
      display: inline-block;
      padding: 0.2rem 0.5rem;
      border-radius: 4px;
      font-size: 0.75rem;
      font-weight: 700;
    }
    .difficulty-badge.beginner { background: #e8f0e4; color: var(--mm-green); }
    .difficulty-badge.intermediate { background: #fff4d6; color: #b8860b; }
    .difficulty-badge.advanced { background: #ffe8e8; color: #c53030; }
    .job-gap-card {
      background: var(--mm-card);
      border: 1px solid var(--mm-border);
      border-radius: var(--radius);
      padding: 1.5rem;
      margin-bottom: 1.25rem;
      box-shadow: var(--shadow);
    }
    .job-gap-card h3 {
      font-size: 1.2rem;
      font-weight: 700;
      color: var(--mm-green);
      margin: 0 0 0.5rem 0;
    }
    .job-gap-card .job-meta-info {
      font-size: 0.9rem;
      color: var(--mm-muted);
      margin-bottom: 1rem;
    }
    .job-gap-card .gap-label {
      font-weight: 600;
      color: var(--mm-text);
      margin-bottom: 0.5rem;
      font-size: 0.95rem;
    }
    .job-gap-card .gap-skills {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }
    .gap-skill-tag {
      background: #ffe8e8;
      color: #c53030;
      padding: 0.4rem 0.8rem;
      border-radius: 999px;
      font-size: 0.85rem;
      font-weight: 600;
    }
    .no-gaps {
      color: var(--mm-green);
      font-weight: 600;
      font-size: 0.9rem;
    }
  </style>
</head>
<body>
  <header class="site-header">
    <div class="site-logo">Moultrie <span>Mobile</span></div>
    <nav class="main-nav">
      <a href="about.html">About</a>
      <a href="#home" data-view="home">Home</a>
      <a href="#employee" data-view="employee">Prospective employee</a>
      <a href="#employer" data-view="employer">Employer</a>
    </nav>
  </header>
  <main>
    <section class="hero">
      <div class="hero-bg" aria-hidden="true"></div>
      <h1>Career Match</h1>
      <p>Internal career assistant for Moultrie Mobile employees and hiring managers.</p>
    </section>

    <section id="home" class="view-section active">
      <div class="intro">
        <p class="intro-lead warm">Welcome. This is Moultrie Mobile‚Äôs internal AI career dashboard, designed for employees and hiring managers ‚Äî not the public web.</p>

        <div class="role-selector">
          <a href="#employee" class="role-card">
            <h2>I‚Äôm a prospective employee</h2>
            <p>Get job matches, training suggestions, and a clear view of why each role fits you.</p>
          </a>
          <a href="#employer" class="role-card">
            <h2>I‚Äôm an employer</h2>
            <p>Review candidates, understand AI match scores, and explore internal talent.</p>
          </a>
        </div>

        <p class="intro-lead warm">This isn‚Äôt a faceless form ‚Äî it‚Äôs an AI that‚Äôs on your side. We want to help you find a role at Moultrie Mobile that actually fits <em>you</em>: your skills, how you like to work, and what you care about.</p>

        <div class="nature-strip">
          <img src="https://images.unsplash.com/photo-1441974231531-c6227db76b6e?w=1200&q=90" alt="Forest path" />
          <img src="images/antler-shadow.png" alt="Antler shadow on rustic metal" />
          <img src="https://images.unsplash.com/photo-1470071459604-3b5ec3a7fe05?w=1200&q=90" alt="Misty forest" />
        </div>

        <p class="warm">We care about <strong>transparency</strong> and <strong>authenticity</strong>. No hidden scoring, no bias ‚Äî we listen to what you share and match you honestly. Upload your resume and answer a few human-centered questions. Then you get to choose: should we lean more on your experience and hard skills, or more on the human stuff ‚Äî how you work, what you value, the kind of team you want? Your call.</p>
        <p class="warm">Every suggestion we make comes with a clear, visual breakdown so you see exactly why we recommended it. No black box. And <strong>your privacy is non-negotiable</strong>: by default we don‚Äôt keep your data. When you leave, we forget it. If you want to save your progress, you can choose to keep it.</p>

        <div class="intro-blocks">
          <div class="intro-block">
            <h3>How it works</h3>
            <p>Upload a resume, answer a few questions, and choose whether matches lean toward skills or fit. We‚Äôll show you roles and explain every decision ‚Äî in plain language.</p>
          </div>
          <div class="intro-block">
            <h3>You‚Äôre in control</h3>
            <p>Pick Prospective employee or Employer above whenever you‚Äôre ready. No pressure. We‚Äôre here.</p>
          </div>
        </div>

        <p class="intro-cta">Choose <strong>Prospective employee</strong> or <strong>Employer</strong> above when you‚Äôre ready to start.</p>
      </div>
    </section>

    <section id="employee" class="view-section">
      <div class="employee-section-header">
        <h2 class="employee-section-title">Prospective employee</h2>
        <p class="employee-section-tagline">Your path to the right role ‚Äî explore tools and see how we match you.</p>
      </div>
      <p class="employee-section-intro">
        Here you can upload your resume, answer personalized questions, and see job matches tailored to you. Use the options below to get started: answer questions so we understand your preferences, upload your resume to match against open roles, explore training suggestions, view your top job recommendations, or see exactly how our AI weighed each match. You can also save jobs you like for later.
      </p>
      <div class="option-grid">
        <a href="#personalized-questions" class="option-card">Personalized Questions</a>
        <a href="#upload-resume" class="option-card">Upload Resume</a>
        <a href="#training-match" class="option-card">Training & Courses Match</a>
        <a href="ai-breakdown.html" class="option-card">AI Decision Breakdown</a>
        <a href="liked-jobs.html" class="option-card">Liked jobs</a>
        <a href="#my-progress" class="option-card">My Saved Profile</a>
      </div>
    </section>

    <section id="my-progress" class="view-section">
      <a href="#employee" class="back-link">‚Üê Back to options</a>
      <h2 class="view-title">My saved profile</h2>
      <p class="intro" style="margin-bottom: 1.5rem;">A quick snapshot of what you‚Äôve saved in this browser (resume, answers, matches, liked jobs) ‚Äî plus shortcuts to keep moving.</p>

      <div class="intro-block" style="margin-bottom: 1.5rem;">
        <div id="progress-status" style="display:grid;gap:0.75rem;"></div>
        <div style="display:flex;gap:0.75rem;flex-wrap:wrap;margin-top:1rem;">
          <a href="#upload-resume" class="option-card" style="display:inline-block;padding:0.9rem 1.1rem;min-height:auto;">Upload Resume</a>
          <a href="#personalized-questions" class="option-card" style="display:inline-block;padding:0.9rem 1.1rem;min-height:auto;">Personalized Questions</a>
          <a href="ai-breakdown.html" class="option-card" style="display:inline-block;padding:0.9rem 1.1rem;min-height:auto;">AI Decision Breakdown</a>
          <a href="liked-jobs.html" class="option-card" style="display:inline-block;padding:0.9rem 1.1rem;min-height:auto;">Liked jobs</a>
        </div>
        <div style="margin-top:1rem;">
          <button type="button" id="clear-saved-profile" class="upload-resume-btn" style="padding:0.7rem 1.1rem;">Clear saved data (this browser)</button>
          <p style="margin:0.5rem 0 0;font-size:0.85rem;color:var(--mm-muted);">Clears saved answers, sanitized resume text, match list, and liked jobs from local/session storage.</p>
        </div>
      </div>

      <div id="saved-answers-section" style="display:none;margin-top:2rem;">
        <h3 style="font-size:1.2rem;font-weight:700;color:var(--mm-green);margin-bottom:1rem;">Your Saved Answers</h3>
        <div id="saved-answers-content" style="background:var(--mm-card);border:1px solid var(--mm-border);border-radius:var(--radius);padding:1.5rem;margin-bottom:1rem;"></div>
        <a href="#personalized-questions" class="option-card" style="display:inline-block;padding:0.9rem 1.1rem;min-height:auto;">Edit Answers</a>
      </div>
    </section>

    <section id="upload-resume" class="view-section">
      <a href="#employee" class="back-link">‚Üê Back to options</a>
      <h2 class="view-title">Upload Resume to Find Next Job</h2>
      <div class="intro">
        <p class="intro-lead">Upload your resume (PDF, Word, or plain text). Our AI will scan it for key sections so we can match you to the right roles.</p>
      </div>
      <div class="upload-resume-block intro-block">
        <div class="match-by-box">
          <h3>Match by</h3>
          <div class="match-by-options" role="radiogroup" aria-label="Match by experience or interests">
            <label><input type="radio" name="match-by" value="experience" checked /> Experience</label>
            <label><input type="radio" name="match-by" value="interests" /> Interests</label>
          </div>
          <p>Experience uses your skills and qualifications. Interests uses your activities, leadership, and what you care about.</p>
        </div>
        <p class="upload-bias-note" style="margin:0;color:var(--mm-muted);font-size:0.9rem;line-height:1.55;">
          <strong>Bias-free resume reviewer:</strong> we focus on skills and experience only. We do not use school, graduation year, age, name, location, race, gender, or other personal details to score your matches.
        </p>
        <div class="upload-zone">
          <input type="file" id="resume-file" accept=".pdf,.docx,.doc,.txt" hidden />
          <button type="button" id="upload-resume-btn" class="upload-resume-btn">Choose resume file</button>
          <p class="upload-hint">PDF, Word (.docx, .doc), or plain text</p>
        </div>
        <p id="resume-file-name" class="resume-file-name"></p>
        <div id="resume-scan-status" class="resume-scan-status" aria-live="polite"></div>
        <div id="resume-scan-results" class="resume-scan-results" hidden></div>
        <div id="resume-job-matches" class="job-matches-wrap" hidden></div>
      </div>
    </section>

    <section id="personalized-questions" class="view-section">
      <a href="#employee" class="back-link">‚Üê Back to options</a>
      <h2 class="view-title">Personalized Questions</h2>
      <p class="intro" style="margin-bottom: 1.5rem;">Help us match you with the right roles. Your answers stay private and shape your recommendations.</p>

      <form id="personalized-form" class="personalized-form">
          <div class="question-block">
            <label>What sectors are you interested in?</label>
            <span class="hint">Select all that apply ‚Äî click to toggle multiple</span>
            <div class="choice-row sector-chips" role="group" aria-label="Sectors (multi-select)">
              <label><input type="checkbox" name="sectors" value="tech"> Tech & IT</label>
              <label><input type="checkbox" name="sectors" value="operations"> Operations</label>
              <label><input type="checkbox" name="sectors" value="hr"> HR & People</label>
              <label><input type="checkbox" name="sectors" value="finance"> Finance</label>
              <label><input type="checkbox" name="sectors" value="sales"> Sales & Marketing</label>
              <label><input type="checkbox" name="sectors" value="engineering"> Engineering</label>
              <label><input type="checkbox" name="sectors" value="other-sector"> Other</label>
            </div>
            <input type="text" name="sectors-other" placeholder="Other sector(s)" style="margin-top: 0.75rem;" aria-label="Other sectors">
          </div>

          <div class="question-block">
            <label>What type of job?</label>
            <span class="hint">How do you prefer to work?</span>
            <div class="choice-row">
              <label><input type="radio" name="work-mode" value="remote"> Remote</label>
              <label><input type="radio" name="work-mode" value="in-person"> In person</label>
              <label><input type="radio" name="work-mode" value="hybrid"> Hybrid</label>
            </div>
          </div>

          <div class="question-block">
            <label>Personality & work style</label>
            <span class="hint">Select all that apply ‚Äî click to toggle multiple</span>
            <div class="choice-row sector-chips" role="group" aria-label="Personality and work style (multi-select)">
              <label><input type="checkbox" name="traits" value="introvert"> Introvert</label>
              <label><input type="checkbox" name="traits" value="extrovert"> Extrovert</label>
              <label><input type="checkbox" name="traits" value="workaholic"> Workaholic</label>
              <label><input type="checkbox" name="traits" value="balanced"> Balanced boundaries</label>
              <label><input type="checkbox" name="traits" value="collaborative"> Collaborative</label>
              <label><input type="checkbox" name="traits" value="independent"> Independent</label>
              <label><input type="checkbox" name="traits" value="structured"> Structured / process-driven</label>
              <label><input type="checkbox" name="traits" value="adaptive"> Adaptive / flexible</label>
            </div>
            <input type="text" name="traits-other" placeholder="Other traits (e.g. morning person, night owl)" style="margin-top: 0.75rem;" aria-label="Other personality traits">
          </div>

          <div class="question-block">
            <label>Preferred role type</label>
            <span class="hint">Individual contributor vs. people leadership</span>
            <div class="choice-row">
              <label><input type="checkbox" name="role-type" value="ic"> Individual contributor</label>
              <label><input type="checkbox" name="role-type" value="lead"> Team lead</label>
              <label><input type="checkbox" name="role-type" value="manager"> Manager</label>
              <label><input type="checkbox" name="role-type" value="director"> Director / Executive</label>
            </div>
          </div>

          <div class="question-block">
            <label>Employment type</label>
            <span class="hint">What are you looking for?</span>
            <div class="choice-row">
              <label><input type="radio" name="employment-type" value="fulltime"> Full-time</label>
              <label><input type="radio" name="employment-type" value="parttime"> Part-time</label>
              <label><input type="radio" name="employment-type" value="contract"> Contract / Freelance</label>
              <label><input type="radio" name="employment-type" value="flexible"> Flexible / open</label>
            </div>
          </div>

          <div class="question-block">
            <label>When can you start?</label>
            <span class="hint">Earliest start date</span>
            <div class="choice-row">
              <label><input type="radio" name="start-date" value="immediate"> Immediately</label>
              <label><input type="radio" name="start-date" value="2weeks"> Within 2 weeks</label>
              <label><input type="radio" name="start-date" value="1month"> Within 1 month</label>
              <label><input type="radio" name="start-date" value="2months"> 2+ months</label>
            </div>
          </div>

          <div class="question-block">
            <label>What matters most to you?</label>
            <span class="hint">Select your top priorities (we use this to rank fit)</span>
            <div class="choice-row">
              <label><input type="checkbox" name="priorities" value="salary"> Salary & compensation</label>
              <label><input type="checkbox" name="priorities" value="benefits"> Benefits (health, 401k, etc.)</label>
              <label><input type="checkbox" name="priorities" value="worklife"> Work-life balance</label>
              <label><input type="checkbox" name="priorities" value="growth"> Growth & learning</label>
              <label><input type="checkbox" name="priorities" value="culture"> Company culture</label>
              <label><input type="checkbox" name="priorities" value="flexibility"> Flexibility (schedule, location)</label>
            </div>
          </div>

          <div class="question-block">
            <label>Team size preference</label>
            <span class="hint">Environment you thrive in</span>
            <div class="choice-row">
              <label><input type="radio" name="team-size" value="small"> Small (&lt;10)</label>
              <label><input type="radio" name="team-size" value="mid"> Mid-size (10‚Äì50)</label>
              <label><input type="radio" name="team-size" value="large"> Large (50+)</label>
              <label><input type="radio" name="team-size" value="nopref"> No preference</label>
            </div>
          </div>

          <div class="question-block">
            <label>Willing to relocate?</label>
            <span class="hint">For roles that require or prefer on-site</span>
            <div class="choice-row">
              <label><input type="radio" name="relocate" value="yes"> Yes</label>
              <label><input type="radio" name="relocate" value="no"> No</label>
              <label><input type="radio" name="relocate" value="prefer-not"> Prefer not to say</label>
            </div>
          </div>

          <div class="question-block">
            <label>Can we use your name to save your profile?</label>
            <span class="hint">If Yes, employers can see your name when reviewing potential candidates who match their roles. If No, your profile is saved without your name for anonymity.</span>
            <div class="choice-row">
              <label><input type="radio" name="save-name" value="yes" id="save-name-yes"> Yes ‚Äî use my name so employers can review me</label>
              <label><input type="radio" name="save-name" value="no" id="save-name-no"> No ‚Äî save my profile without my name</label>
            </div>
            <div id="save-name-contact" class="question-block" style="display:none; margin-top:1rem; padding-top:1rem; border-top:1px solid var(--mm-border);">
              <label for="profile-name">Your name</label>
              <input type="text" id="profile-name" name="profile_name" placeholder="e.g. Jordan Smith" aria-label="Your name">
              <label for="profile-email" style="margin-top:0.75rem; display:block;">Email</label>
              <input type="email" id="profile-email" name="profile_email" placeholder="you@example.com" aria-label="Email">
            </div>
          </div>

          <div class="question-block">
            <label for="anything-else">Anything else we should know?</label>
            <span class="hint">Goals, constraints, preferences, or what matters most to you</span>
            <textarea id="anything-else" name="anything_else" placeholder="e.g. career goals, schedule needs, must-haves in a team..."></textarea>
          </div>

          <button type="submit" class="personalized-submit">Save my answers</button>
        </form>
    </section>

    <section id="training-match" class="view-section">
      <a href="#employee" class="back-link">‚Üê Back to options</a>
      <h2 class="view-title">Training & Courses Match</h2>
      <p class="intro" style="margin-bottom: 1.5rem;">Based on your resume and job matches, we've identified skill gaps and found courses to help you close them. Sort by skill, cost, or difficulty.</p>

      <div id="training-no-data" class="intro-block" style="display:none;">
        <p style="margin:0;">Upload your resume and get job matches first to see personalized training recommendations.</p>
      </div>

      <div id="training-content" style="display:none;">
        <div id="matched-jobs-section" style="margin-bottom: 2rem;"></div>
        
        <div class="intro-block" style="margin-bottom: 1.5rem;">
          <div style="display:flex;align-items:center;gap:1rem;flex-wrap:wrap;margin-bottom:1rem;">
            <label style="font-weight:600;color:var(--mm-green);">Sort by:</label>
            <select id="course-sort" style="padding:0.5rem 1rem;border:2px solid var(--mm-green);border-radius:var(--radius-sm);background:#e8f0e4;font-weight:600;cursor:pointer;">
              <option value="skill">Skill name</option>
              <option value="cost">Cost (low to high)</option>
              <option value="cost-desc">Cost (high to low)</option>
              <option value="difficulty">Difficulty (easy to hard)</option>
              <option value="difficulty-desc">Difficulty (hard to easy)</option>
            </select>
          </div>
          <div id="skill-gaps-summary" style="font-size:0.9rem;color:var(--mm-muted);"></div>
        </div>
        <div id="courses-list" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:1.25rem;"></div>
      </div>
    </section>

    <section id="employer" class="view-section">
      <h2 class="view-title">Employer</h2>
      <div class="employer-placeholder">
        This area is for hiring managers. You can open the dedicated employer dashboard to see candidates
        who have explicitly chosen to make their profiles visible.
        <div style="margin-top:1rem;">
          <a href="employer-dashboard.html" class="option-card" style="display:inline-block;">Open employer dashboard</a>
        </div>
      </div>
    </section>
  </main>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
  <script>if (typeof pdfjsLib !== 'undefined') { pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js'; }</script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
  <button type="button" class="chat-toggle" id="chat-toggle" aria-label="Open chat" title="Chat">üí¨</button>
  <div class="chat-panel" id="chat-panel" role="dialog" aria-label="Chat">
    <div class="chat-header">
      <span>Hi! I'm here if you have questions.</span>
      <button type="button" class="chat-close" id="chat-close" aria-label="Close chat">&times;</button>
    </div>
    <div class="chat-messages" id="chat-messages"></div>
    <div class="chat-input-wrap">
      <input type="text" id="chat-input" placeholder="Ask me anything..." autocomplete="off" />
      <button type="button" id="chat-send">Send</button>
    </div>
  </div>
  <script>
    const EMPLOYEE_SUB_ANCHORS = ['personalized-questions', 'upload-resume', 'job-dashboard'];
    function setView() {
      const hash = location.hash.slice(1) || 'home';
      let activeView;
      if (hash === 'personalized-questions') {
        activeView = 'personalized-questions';
      } else if (hash === 'my-progress') {
        activeView = 'my-progress';
      } else if (hash === 'upload-resume') {
        activeView = 'upload-resume';
      } else if (hash === 'training-match') {
        activeView = 'training-match';
      } else if (EMPLOYEE_SUB_ANCHORS.includes(hash)) {
        activeView = 'employee';
      } else if (hash === 'employer' || hash === 'home' || hash === 'employee') {
        activeView = hash;
      } else {
        activeView = 'home';
      }
      document.querySelectorAll('.view-section').forEach(s => s.classList.remove('active'));
      document.querySelectorAll('.main-nav a').forEach(a => a.classList.remove('active'));
      const section = document.getElementById(activeView);
      const link = document.querySelector(`.main-nav a[data-view="${activeView}"]`) || (activeView === 'upload-resume' || activeView === 'personalized-questions' ? document.querySelector('.main-nav a[data-view="employee"]') : null);
      if (section) section.classList.add('active');
      if (link) link.classList.add('active');
      if (EMPLOYEE_SUB_ANCHORS.includes(hash)) {
        setTimeout(function() {
          const el = document.getElementById(hash);
          if (el) el.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }, 50);
      }

      if (activeView === 'my-progress') {
        try { renderSavedProfile(); } catch (e) {}
      }
      if (hash === 'training-match') {
        try { renderTrainingCourses(); } catch (e) {}
      }
      if (activeView === 'personalized-questions') {
        try { prefillPersonalizedForm(); } catch (e) {}
      }
    }
    window.addEventListener('hashchange', setView);
    window.addEventListener('load', setView);

    function formatWhen(iso) {
      if (!iso) return null;
      try {
        var d = new Date(iso);
        if (Number.isNaN(d.getTime())) return null;
        return d.toLocaleString();
      } catch (e) { return null; }
    }

    function renderSavedProfile() {
      var wrap = document.getElementById('progress-status');
      if (!wrap) return;

      var hasResume = false, resumeAt = null;
      var hasAnswers = false, answersAt = null;
      var matchCount = 0, likedCount = 0;
      var visibleToEmployers = null;

      try {
        var sanitized = localStorage.getItem('moultrie_resume_sanitized');
        var at = localStorage.getItem('moultrie_resume_at');
        hasResume = !!(sanitized && sanitized.trim());
        resumeAt = formatWhen(at);
      } catch (e) {}

      try {
        var raw = localStorage.getItem('moultrie_personalized');
        var at = localStorage.getItem('moultrie_personalized_at');
        hasAnswers = !!raw;
        answersAt = formatWhen(at);
      } catch (e) {}

      try {
        var raw = sessionStorage.getItem('mmJobMatches');
        var parsed = raw ? JSON.parse(raw) : [];
        matchCount = Array.isArray(parsed) ? parsed.length : 0;
      } catch (e) { matchCount = 0; }

      try {
        var raw = localStorage.getItem('moultrie_liked_jobs');
        var parsed = raw ? JSON.parse(raw) : [];
        likedCount = Array.isArray(parsed) ? parsed.length : 0;
      } catch (e) { likedCount = 0; }

      try {
        visibleToEmployers = localStorage.getItem('moultrie_visible_to_employers');
      } catch (e) {}

      var rows = [
        { label: 'Resume uploaded', ok: hasResume, detail: hasResume ? ('Yes' + (resumeAt ? ' ‚Ä¢ ' + resumeAt : '')) : 'No' },
        { label: 'Questions answered', ok: hasAnswers, detail: hasAnswers ? ('Yes' + (answersAt ? ' ‚Ä¢ ' + answersAt : '')) : 'No' },
        { label: 'Liked jobs', ok: likedCount > 0, detail: likedCount > 0 ? likedCount + ' saved' : 'None yet' },
        { label: 'Visible to employers', ok: visibleToEmployers === 'public', detail: visibleToEmployers === 'public' ? 'Yes (opted in)' : (visibleToEmployers === 'private' ? 'No (opted out)' : 'Not set') }
      ];

      wrap.innerHTML = rows.map(function(r) {
        return '<div style="display:flex;justify-content:space-between;gap:1rem;align-items:flex-start;">' +
          '<div style="font-weight:700;color:var(--mm-green);">' + r.label + '</div>' +
          '<div style="text-align:right;color:' + (r.ok ? 'var(--mm-text)' : 'var(--mm-muted)') + ';">' +
            (r.ok ? '‚úì ' : '‚Äî ') + r.detail +
          '</div></div>';
      }).join('');

      var clearBtn = document.getElementById('clear-saved-profile');
      if (clearBtn && !clearBtn.__bound) {
        clearBtn.__bound = true;
        clearBtn.addEventListener('click', function() {
          try {
            localStorage.removeItem('moultrie_personalized');
            localStorage.removeItem('moultrie_personalized_at');
            localStorage.removeItem('moultrie_resume_sanitized');
            localStorage.removeItem('moultrie_resume_at');
            localStorage.removeItem('moultrie_resume_text');
            localStorage.removeItem('moultrie_resume_job_matches');
            localStorage.removeItem('moultrie_liked_jobs');
            localStorage.removeItem('moultrie_visible_to_employers');
            sessionStorage.removeItem('mmJobMatches');
            sessionStorage.removeItem('mmResumeText');
          } catch (e) {}
          renderSavedProfile();
        });
      }

      // Display saved answers
      var savedAnswersSection = document.getElementById('saved-answers-section');
      var savedAnswersContent = document.getElementById('saved-answers-content');
      if (savedAnswersSection && savedAnswersContent) {
        try {
          var raw = localStorage.getItem('moultrie_personalized');
          var visibleToEmployers = localStorage.getItem('moultrie_visible_to_employers');
          var hasAnswers = !!raw;
          var hasVisibility = !!visibleToEmployers;
          
          if (hasAnswers || hasVisibility) {
            var answers = raw ? JSON.parse(raw) : {};
            var labels = {
              'work-mode': { remote: 'Remote', 'in-person': 'In person', hybrid: 'Hybrid' },
              'employment-type': { fulltime: 'Full-time', parttime: 'Part-time', contract: 'Contract / Freelance', flexible: 'Flexible / open' },
              'start-date': { immediate: 'Immediately', '2weeks': 'Within 2 weeks', '1month': 'Within 1 month', '2months': '2+ months' },
              'team-size': { small: 'Small (<10)', mid: 'Mid-size (10‚Äì50)', large: 'Large (50+)', nopref: 'No preference' },
              'relocate': { yes: 'Yes', no: 'No', 'prefer-not': 'Prefer not to say' },
              'save-name': { yes: 'Yes', no: 'No' },
              'priorities': { salary: 'Salary & compensation', benefits: 'Benefits', worklife: 'Work-life balance', growth: 'Growth & learning', culture: 'Company culture', flexibility: 'Flexibility' },
              'traits': { introvert: 'Introvert', extrovert: 'Extrovert', workaholic: 'Workaholic', balanced: 'Balanced boundaries', collaborative: 'Collaborative' },
              'sectors': { tech: 'Tech & IT', operations: 'Operations', hr: 'HR & People', finance: 'Finance', sales: 'Sales & Marketing', engineering: 'Engineering' }
            };
            var html = '<div style="display:grid;gap:1rem;">';
            if (answers['work-mode']) {
              html += '<div><strong style="color:var(--mm-green);">Work Mode:</strong> ' + (labels['work-mode'][answers['work-mode']] || answers['work-mode']) + '</div>';
            }
            if (answers['employment-type']) {
              html += '<div><strong style="color:var(--mm-green);">Employment Type:</strong> ' + (labels['employment-type'][answers['employment-type']] || answers['employment-type']) + '</div>';
            }
            if (answers['start-date']) {
              html += '<div><strong style="color:var(--mm-green);">Start Date:</strong> ' + (labels['start-date'][answers['start-date']] || answers['start-date']) + '</div>';
            }
            if (answers['team-size']) {
              html += '<div><strong style="color:var(--mm-green);">Team Size:</strong> ' + (labels['team-size'][answers['team-size']] || answers['team-size']) + '</div>';
            }
            if (answers['relocate']) {
              html += '<div><strong style="color:var(--mm-green);">Willing to Relocate:</strong> ' + (labels['relocate'][answers['relocate']] || answers['relocate']) + '</div>';
            }
            if (answers['priorities']) {
              var priorities = [].concat(answers['priorities']).filter(Boolean);
              if (priorities.length) {
                html += '<div><strong style="color:var(--mm-green);">Priorities:</strong> ' + priorities.map(function(p) { return labels['priorities'][p] || p; }).join(', ') + '</div>';
              }
            }
            if (answers['traits']) {
              var traits = [].concat(answers['traits']).filter(Boolean);
              if (traits.length) {
                html += '<div><strong style="color:var(--mm-green);">Traits:</strong> ' + traits.map(function(t) { return labels['traits'][t] || t; }).join(', ') + '</div>';
              }
            }
            if (answers['sectors']) {
              var sectors = [].concat(answers['sectors']).filter(Boolean);
              if (sectors.length) {
                html += '<div><strong style="color:var(--mm-green);">Sectors:</strong> ' + sectors.map(function(s) { return labels['sectors'][s] || s; }).join(', ') + '</div>';
              }
            }
            if (answers['anything_else']) {
              html += '<div><strong style="color:var(--mm-green);">Additional Notes:</strong> ' + answers['anything_else'] + '</div>';
            }
            if (answers['profile_name']) {
              html += '<div><strong style="color:var(--mm-green);">Name:</strong> ' + answers['profile_name'] + '</div>';
            }
            if (answers['profile_email']) {
              html += '<div><strong style="color:var(--mm-green);">Email:</strong> ' + answers['profile_email'] + '</div>';
            }
            // Always show visibility status
            var visibilityText = visibleToEmployers === 'public' ? 'Yes (opted in)' : (visibleToEmployers === 'private' ? 'No (opted out)' : 'Not set');
            html += '<div><strong style="color:var(--mm-green);">Visible to Employers:</strong> ' + visibilityText + '</div>';
            html += '</div>';
            savedAnswersContent.innerHTML = html;
            savedAnswersSection.style.display = 'block';
          } else {
            // Show visibility status even if no other answers
            var visibilityText = visibleToEmployers === 'public' ? 'Yes (opted in)' : (visibleToEmployers === 'private' ? 'No (opted out)' : 'Not set');
            savedAnswersContent.innerHTML = '<div style="display:grid;gap:1rem;"><div><strong style="color:var(--mm-green);">Visible to Employers:</strong> ' + visibilityText + '</div></div>';
            savedAnswersSection.style.display = 'block';
          }
        } catch (e) {
          console.warn('Error rendering saved answers:', e);
          savedAnswersSection.style.display = 'none';
        }
      }
    }

    (function trainingCourses() {
      var COURSE_CATALOG = [
        { title: 'Foundations of Project Management', provider: 'Coursera', skill: 'project management', cost: 0, difficulty: 'beginner', url: 'https://www.coursera.org/learn/project-management-foundations', hours: 12 },
        { title: 'Agile Crash Course', provider: 'Udemy', skill: 'agile', cost: 19, difficulty: 'beginner', url: 'https://www.udemy.com/course/agile-crash-course', hours: 6 },
        { title: 'Scrum: The Basics', provider: 'LinkedIn Learning', skill: 'scrum', cost: 0, difficulty: 'beginner', url: 'https://www.linkedin.com/learning/scrum-the-basics', hours: 2 },
        { title: 'Customer Service Fundamentals', provider: 'Coursera', skill: 'customer service', cost: 0, difficulty: 'beginner', url: 'https://www.coursera.org/learn/customer-service-fundamentals', hours: 10 },
        { title: 'Salesforce CRM - A Complete Introduction', provider: 'Udemy', skill: 'CRM', cost: 24, difficulty: 'beginner', url: 'https://www.udemy.com/course/salesforce-crm-complete-introduction', hours: 5 },
        { title: 'Develop Your Sales Knowledge and Skills', provider: 'LinkedIn Learning', skill: 'sales', cost: 0, difficulty: 'beginner', url: 'https://www.linkedin.com/learning/paths/develop-your-sales-knowledge-and-skills', hours: 7 },
        { title: 'Sales Strategy', provider: 'Coursera', skill: 'sales', cost: 0, difficulty: 'intermediate', url: 'https://www.coursera.org/learn/sales-strategy', hours: 15 },
        { title: 'Successful Negotiation', provider: 'Coursera', skill: 'negotiation', cost: 0, difficulty: 'intermediate', url: 'https://www.coursera.org/learn/negotiation-skills', hours: 9 },
        { title: 'JavaScript Algorithms and Data Structures', provider: 'freeCodeCamp', skill: 'javascript', cost: 0, difficulty: 'beginner', url: 'https://www.freecodecamp.org/learn/javascript-algorithms-and-data-structures', hours: 40 },
        { title: 'Complete Python Bootcamp', provider: 'Udemy', skill: 'python', cost: 29, difficulty: 'beginner', url: 'https://www.udemy.com/course/complete-python-bootcamp', hours: 22 },
        { title: 'Python for Everybody', provider: 'Coursera', skill: 'python', cost: 0, difficulty: 'beginner', url: 'https://www.coursera.org/specializations/python', hours: 30 },
        { title: 'The Complete Web Development Bootcamp', provider: 'Udemy', skill: 'web', cost: 39, difficulty: 'intermediate', url: 'https://www.udemy.com/course/the-complete-web-development-bootcamp', hours: 50 },
        { title: 'REST APIs with Flask and Python', provider: 'Udemy', skill: 'API', cost: 24, difficulty: 'intermediate', url: 'https://www.udemy.com/course/rest-api-flask-and-python', hours: 6 },
        { title: 'Git and GitHub', provider: 'freeCodeCamp', skill: 'git', cost: 0, difficulty: 'beginner', url: 'https://www.freecodecamp.org/learn', hours: 4 },
        { title: 'Learning JavaScript Debugging', provider: 'LinkedIn Learning', skill: 'debugging', cost: 0, difficulty: 'intermediate', url: 'https://www.linkedin.com/learning/learning-javascript-debugging-2', hours: 5 },
        { title: 'Debugging: Hunting and Squashing Bugs', provider: 'Coursera', skill: 'debugging', cost: 0, difficulty: 'intermediate', url: 'https://www.coursera.org/learn/debugging-hunting-and-squashing-bugs', hours: 6 },
        { title: 'Operations Management', provider: 'Coursera', skill: 'operations', cost: 0, difficulty: 'beginner', url: 'https://www.coursera.org/learn/wharton-operations', hours: 12 },
        { title: 'Supply Chain Fundamentals', provider: 'Coursera', skill: 'logistics', cost: 0, difficulty: 'beginner', url: 'https://www.coursera.org/learn/supply-chain-fundamentals', hours: 8 },
        { title: 'Operations Management: Inventory Management', provider: 'Udemy', skill: 'inventory', cost: 24, difficulty: 'beginner', url: 'https://www.udemy.com/course/inventory-management-h', hours: 6 },
        { title: 'OSHA Safety Pro: Trenching Excavation & Soil Mechanics', provider: 'Udemy', skill: 'safety compliance', cost: 29, difficulty: 'beginner', url: 'https://www.udemy.com/course/osha-safety-pro-trenching-excavation-soil-mechanics', hours: 10 },
        { title: 'Human Resources', provider: 'Coursera', skill: 'HR', cost: 0, difficulty: 'beginner', url: 'https://www.coursera.org/learn/human-resources', hours: 7 },
        { title: 'Recruiting, Hiring, and Onboarding Employees', provider: 'Coursera', skill: 'recruiting', cost: 0, difficulty: 'intermediate', url: 'https://www.coursera.org/learn/recruiting-hiring-onboarding-employees', hours: 11 },
        { title: 'How to Design and Deliver Training Programs', provider: 'LinkedIn Learning', skill: 'training', cost: 0, difficulty: 'intermediate', url: 'https://www.linkedin.com/learning/how-to-design-and-deliver-training-programs', hours: 9 },
        { title: 'Onboarding New Hires', provider: 'LinkedIn Learning', skill: 'onboarding', cost: 0, difficulty: 'beginner', url: 'https://www.linkedin.com/learning/onboarding-new-hires', hours: 5 },
        { title: 'Inspiring and Motivating Individuals', provider: 'Coursera', skill: 'team leadership', cost: 0, difficulty: 'beginner', url: 'https://www.coursera.org/learn/motivate-people-teams', hours: 10 },
        { title: 'Leading Teams', provider: 'Coursera', skill: 'team leadership', cost: 0, difficulty: 'intermediate', url: 'https://www.coursera.org/learn/leading-teams', hours: 15 },
        { title: 'Process Improvement', provider: 'LinkedIn Learning', skill: 'process improvement', cost: 0, difficulty: 'intermediate', url: 'https://www.linkedin.com/learning/process-improvement-foundations', hours: 8 },
        { title: 'Budgeting and Scheduling Projects', provider: 'Coursera', skill: 'budget', cost: 0, difficulty: 'intermediate', url: 'https://www.coursera.org/learn/schedule-projects', hours: 12 },
        { title: 'Key Performance Indicators', provider: 'LinkedIn Learning', skill: 'KPIs', cost: 0, difficulty: 'intermediate', url: 'https://www.linkedin.com/learning/key-performance-indicators-kpis', hours: 6 },
        { title: 'Community Engagement in Research and Population Health', provider: 'Coursera', skill: 'community', cost: 0, difficulty: 'beginner', url: 'https://www.coursera.org/learn/community-engagement-research-population-health', hours: 7 },
        { title: 'Event Planning', provider: 'LinkedIn Learning', skill: 'events', cost: 0, difficulty: 'intermediate', url: 'https://www.linkedin.com/learning/event-planning-foundations', hours: 10 },
        { title: 'Nonprofit Management Foundations', provider: 'LinkedIn Learning', skill: 'volunteer', cost: 0, difficulty: 'beginner', url: 'https://www.linkedin.com/learning/nonprofit-management-foundations', hours: 5 },
        { title: 'Strategic Partnerships', provider: 'LinkedIn Learning', skill: 'partnerships', cost: 0, difficulty: 'intermediate', url: 'https://www.linkedin.com/learning/strategic-partnerships', hours: 8 },
        { title: 'Communication Strategies for a Virtual Age', provider: 'Coursera', skill: 'outreach', cost: 0, difficulty: 'beginner', url: 'https://www.coursera.org/learn/communication-strategies-virtual-age', hours: 9 },
        { title: 'Customer Relationship Management', provider: 'Coursera', skill: 'client', cost: 0, difficulty: 'intermediate', url: 'https://www.coursera.org/learn/customer-relationship-management', hours: 7 },
        { title: 'Lead Generation', provider: 'LinkedIn Learning', skill: 'lead generation', cost: 0, difficulty: 'beginner', url: 'https://www.linkedin.com/learning/lead-generation-foundations', hours: 6 },
        { title: 'Presentation Skills', provider: 'Coursera', skill: 'presentation', cost: 0, difficulty: 'beginner', url: 'https://www.coursera.org/learn/presentation-skills', hours: 8 },
        { title: 'Troubleshooting and Debugging Techniques', provider: 'Coursera', skill: 'troubleshooting', cost: 0, difficulty: 'intermediate', url: 'https://www.coursera.org/learn/troubleshooting-debugging-techniques', hours: 5 },
        { title: 'Introduction to Technical Writing', provider: 'Coursera', skill: 'documentation', cost: 0, difficulty: 'beginner', url: 'https://www.coursera.org/learn/technical-writing-introduction', hours: 4 },
        { title: 'Work Smarter, Not Harder', provider: 'Coursera', skill: 'scheduling', cost: 0, difficulty: 'beginner', url: 'https://www.coursera.org/learn/work-smarter-not-harder', hours: 7 },
        { title: 'Getting Started as a Project Coordinator', provider: 'LinkedIn Learning', skill: 'coordination', cost: 0, difficulty: 'beginner', url: 'https://www.linkedin.com/learning/paths/getting-started-as-a-project-coordinator', hours: 5 }
      ];

      function extractResumeSkills(resumeText) {
        if (!resumeText) return [];
        var text = '\n' + resumeText.toLowerCase();
        var skillKeywords = [
          'javascript', 'python', 'java', 'html', 'css', 'react', 'node', 'sql', 'git', 'api', 'web', 'programming', 'coding', 'software', 'development',
          'project management', 'agile', 'scrum', 'stakeholder', 'timeline', 'budget',
          'customer service', 'customer support', 'crm', 'phone', 'email', 'troubleshooting', 'onboarding',
          'sales', 'outreach', 'lead generation', 'client', 'pipeline', 'negotiation', 'presentation', 'relationship',
          'operations', 'logistics', 'scheduling', 'coordination', 'inventory', 'documentation', 'safety compliance',
          'training', 'onboarding', 'recruiting', 'hr', 'human resources', 'policies',
          'management', 'team leadership', 'process improvement', 'kpis', 'efficiency',
          'community', 'engagement', 'events', 'volunteer', 'partnerships'
        ];
        var found = [];
        for (var i = 0; i < skillKeywords.length; i++) {
          var kw = skillKeywords[i].toLowerCase();
          if (text.indexOf(kw) !== -1) found.push(kw);
        }
        return found;
      }

      function findSkillGapsForJob(resumeSkills, jobTitle) {
        var jobCatalog = window.MOULTRIE_JOBS || [];
        var jobData = jobCatalog.find(function(j) { return j.title === jobTitle; });
        if (!jobData || !jobData.skills) return [];
        var gaps = [];
        for (var i = 0; i < jobData.skills.length; i++) {
          var reqSkill = jobData.skills[i].toLowerCase();
          var hasIt = resumeSkills.some(function(rs) {
            return rs.indexOf(reqSkill) !== -1 || reqSkill.indexOf(rs) !== -1;
          });
          if (!hasIt) gaps.push(reqSkill);
        }
        return gaps;
      }

      function findSkillGaps(resumeSkills, jobMatches) {
        if (!jobMatches || !jobMatches.length) return [];
        var jobCatalog = window.MOULTRIE_JOBS || [];
        var allRequiredSkills = [];
        for (var i = 0; i < jobMatches.length; i++) {
          var job = jobMatches[i];
          var jobData = jobCatalog.find(function(j) { return j.title === job.title; });
          if (jobData && jobData.skills) {
            for (var j = 0; j < jobData.skills.length; j++) {
              var skill = jobData.skills[j].toLowerCase();
              if (allRequiredSkills.indexOf(skill) === -1) allRequiredSkills.push(skill);
            }
          }
        }
        var gaps = [];
        for (var k = 0; k < allRequiredSkills.length; k++) {
          var reqSkill = allRequiredSkills[k];
          var hasIt = resumeSkills.some(function(rs) {
            return rs.indexOf(reqSkill) !== -1 || reqSkill.indexOf(rs) !== -1;
          });
          if (!hasIt) gaps.push(reqSkill);
        }
        return gaps;
      }

      function matchCoursesToGaps(gaps) {
        if (!gaps || !gaps.length) return [];
        var matched = [];
        for (var i = 0; i < COURSE_CATALOG.length; i++) {
          var course = COURSE_CATALOG[i];
          var courseSkill = course.skill.toLowerCase();
          for (var j = 0; j < gaps.length; j++) {
            var gap = gaps[j];
            if (courseSkill.indexOf(gap) !== -1 || gap.indexOf(courseSkill) !== -1) {
              matched.push(Object.assign({}, course, { gapSkill: gap }));
              break;
            }
          }
        }
        return matched;
      }

      function sortCourses(courses, sortBy) {
        var sorted = courses.slice();
        if (sortBy === 'skill') {
          sorted.sort(function(a, b) { return a.skill.localeCompare(b.skill); });
        } else if (sortBy === 'cost') {
          sorted.sort(function(a, b) { return a.cost - b.cost; });
        } else if (sortBy === 'cost-desc') {
          sorted.sort(function(a, b) { return b.cost - a.cost; });
        } else if (sortBy === 'difficulty') {
          var order = { beginner: 1, intermediate: 2, advanced: 3 };
          sorted.sort(function(a, b) { return (order[a.difficulty] || 0) - (order[b.difficulty] || 0); });
        } else if (sortBy === 'difficulty-desc') {
          var order = { beginner: 1, intermediate: 2, advanced: 3 };
          sorted.sort(function(a, b) { return (order[b.difficulty] || 0) - (order[a.difficulty] || 0); });
        }
        return sorted;
      }

      function renderTrainingCourses() {
        var noDataEl = document.getElementById('training-no-data');
        var contentEl = document.getElementById('training-content');
        var coursesListEl = document.getElementById('courses-list');
        var summaryEl = document.getElementById('skill-gaps-summary');
        var sortEl = document.getElementById('course-sort');
        var matchedJobsEl = document.getElementById('matched-jobs-section');

        if (!noDataEl || !contentEl || !coursesListEl) return;

        var resumeText = null;
        try {
          resumeText = localStorage.getItem('moultrie_resume_sanitized') || sessionStorage.getItem('mmResumeText');
        } catch (e) {}

        var jobMatches = [];
        try {
          var stored = sessionStorage.getItem('mmJobMatches');
          if (stored) {
            var parsed = JSON.parse(stored);
            if (Array.isArray(parsed)) {
              jobMatches = parsed;
            } else if (parsed.best || parsed.other) {
              jobMatches = (parsed.best || []).concat(parsed.other || []);
            }
          }
        } catch (e) {}

        if (!resumeText || !jobMatches || !jobMatches.length) {
          noDataEl.style.display = 'block';
          contentEl.style.display = 'none';
          return;
        }

        noDataEl.style.display = 'none';
        contentEl.style.display = 'block';

        var resumeSkills = extractResumeSkills(resumeText);
        var gaps = findSkillGaps(resumeSkills, jobMatches);
        var courses = matchCoursesToGaps(gaps);

        // Render matched jobs with skill gaps
        if (matchedJobsEl) {
          var jobsHtml = '<h3 style="font-size:1.3rem;font-weight:700;color:var(--mm-green);margin-bottom:1rem;">Your Matched Jobs & Skill Gaps</h3>';
          var jobCatalog = window.MOULTRIE_JOBS || [];
          for (var i = 0; i < jobMatches.length; i++) {
            var job = jobMatches[i];
            var jobData = jobCatalog.find(function(j) { return j.title === job.title; });
            var jobGaps = findSkillGapsForJob(resumeSkills, job.title);
            var matchPct = job.matchPct || 0;
            var location = job.location || (jobData ? jobData.location : '');
            var department = job.department || (jobData ? jobData.department : '');
            
            jobsHtml += '<div class="job-gap-card">';
            jobsHtml += '<h3>' + job.title + '</h3>';
            jobsHtml += '<div class="job-meta-info">';
            if (department) jobsHtml += department + ' ‚Ä¢ ';
            if (location) jobsHtml += location + ' ‚Ä¢ ';
            jobsHtml += matchPct + '% match</div>';
            
            if (jobGaps.length > 0) {
              jobsHtml += '<div class="gap-label">Skills you need to develop:</div>';
              jobsHtml += '<div class="gap-skills">';
              for (var j = 0; j < jobGaps.length; j++) {
                var gapSkill = jobGaps[j];
                var displaySkill = gapSkill.split(' ').map(function(w) {
                  return w.charAt(0).toUpperCase() + w.slice(1);
                }).join(' ');
                jobsHtml += '<span class="gap-skill-tag">' + displaySkill + '</span>';
              }
              jobsHtml += '</div>';
            } else {
              jobsHtml += '<div class="no-gaps">‚úì You have all the required skills for this role!</div>';
            }
            jobsHtml += '</div>';
          }
          matchedJobsEl.innerHTML = jobsHtml;
        }

        if (courses.length === 0) {
          summaryEl.textContent = 'No skill gaps found ‚Äî your resume matches the required skills well!';
          coursesListEl.innerHTML = '<p style="color:var(--mm-muted);">Keep building your skills to stay competitive.</p>';
          return;
        }

        summaryEl.textContent = 'Found ' + gaps.length + ' skill gap' + (gaps.length !== 1 ? 's' : '') + ' across your top matches. Showing ' + courses.length + ' recommended course' + (courses.length !== 1 ? 's' : '') + '.';

        function render() {
          var sortBy = sortEl ? sortEl.value : 'skill';
          var sorted = sortCourses(courses, sortBy);
          coursesListEl.innerHTML = sorted.map(function(c) {
            var costText = c.cost === 0 ? 'Free' : '$' + c.cost;
            return '<div class="course-card">' +
              '<div class="course-provider">' + c.provider + '</div>' +
              '<h3 class="course-title">' + c.title + '</h3>' +
              '<div><span class="course-skill">' + c.skill + '</span></div>' +
              '<div class="course-meta">' +
                '<span><span class="difficulty-badge ' + c.difficulty + '">' + c.difficulty.charAt(0).toUpperCase() + c.difficulty.slice(1) + '</span></span>' +
                '<span>üí∞ ' + costText + '</span>' +
                '<span>‚è± ' + c.hours + ' hours</span>' +
              '</div>' +
              '<a href="' + c.url + '" target="_blank" rel="noopener" class="course-link">View course ‚Üí</a>' +
            '</div>';
          }).join('');
        }

        if (sortEl) {
          sortEl.addEventListener('change', render);
        }
        render();
      }
      window.renderTrainingCourses = renderTrainingCourses;
    })();

    (function likedJobs() {
      var LIKED_KEY = 'moultrie_liked_jobs';
      function getLikedJobs() {
        try { return JSON.parse(localStorage.getItem(LIKED_KEY) || '[]'); }
        catch (e) { return []; }
      }
      function setLikedJobs(arr) { try { localStorage.setItem(LIKED_KEY, JSON.stringify(arr)); } catch (e) {} }
      function jobKey(j) { return (j.title || '') + '|' + (j.department || '') + '|' + (j.location || ''); }
      function isJobLiked(j) {
        var key = jobKey(j);
        return getLikedJobs().some(function (l) { return jobKey(l) === key; });
      }
      window.toggleJobLike = function (j) {
        var list = getLikedJobs();
        var key = jobKey(j);
        var idx = -1;
        for (var i = 0; i < list.length; i++) { if (jobKey(list[i]) === key) { idx = i; break; } }
        if (idx >= 0) list.splice(idx, 1);
        else list.push({ title: j.title, department: j.department, location: j.location });
        setLikedJobs(list);
        if (window.refreshJobMatches) window.refreshJobMatches();
      };
      window.getLikedJobs = getLikedJobs;
      window.isJobLiked = isJobLiked;
    })();

    // Bias-free resume sanitization: strip PII (name, school, dates, location, etc.)
    function sanitizeResumeForAnalysis(text) {
      if (!text || typeof text !== 'string') return '';
      var t = text;
      // Phone numbers (US/international patterns)
      t = t.replace(/\+?1?[-.\s]?\(?[0-9]{3}\)?[-.\s]?[0-9]{3}[-.\s]?[0-9]{4}/g, '[REDACTED]');
      t = t.replace(/[0-9]{3}[-.\s][0-9]{3}[-.\s][0-9]{4}/g, '[REDACTED]');
      // Email addresses
      t = t.replace(/[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}/g, '[REDACTED]');
      // URLs (LinkedIn, personal sites, etc.)
      t = t.replace(/https?:\/\/[^\s]+/g, '[REDACTED]');
      // Street addresses (number + street name patterns)
      t = t.replace(/\d+\s+[\w\s]+(?:Street|St|Avenue|Ave|Road|Rd|Boulevard|Blvd|Lane|Ln|Drive|Dr|Court|Ct|Way|Place|Pl)[.,]?\s*(?:Apt|Suite|Ste|#)?\s*\d*/gi, '[REDACTED]');
      // City, State ZIP (e.g. "Atlanta, GA 30301" or "New York, NY 10001")
      t = t.replace(/[A-Za-z\s]+,\s*[A-Z]{2}\s+\d{5}(-\d{4})?/g, '[REDACTED]');
      t = t.replace(/\b[A-Z][a-z]+(?:\s+[A-Z][a-z]+)*,\s*[A-Z]{2}\b/g, '[REDACTED]');
      // Graduation / education dates (May 2020, 2018-2022, Class of 2020, Expected 2024, etc.)
      t = t.replace(/\b(?:Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)[a-z]*\.?\s+\d{4}\b/gi, '[DATE]');
      t = t.replace(/\b\d{4}\s*[-‚Äì‚Äî]\s*\d{4}\b/g, '[DATE RANGE]');
      t = t.replace(/\b(?:Class of|Graduated|Grad\.?|Expected)\s*\d{4}\b/gi, '[DATE]');
      t = t.replace(/\b(?:Spring|Fall|Winter|Summer)\s+\d{4}\b/gi, '[DATE]');
      // School / university names (common patterns)
      t = t.replace(/\b(?:University|College|School|Institute|Academy)\s+of\s+[\w\s]+/gi, '[INSTITUTION]');
      t = t.replace(/\b[\w\s]+(?:University|College|State University|Community College)\b/gi, '[INSTITUTION]');
      t = t.replace(/\b(?:High School|High Sch\.?)\s*[:\-]?\s*[\w\s]+/gi, '[INSTITUTION]');
      // Remove typical "name" header line (often first line: 2‚Äì4 capitalized words)
      var lines = t.split(/\r?\n/);
      if (lines.length > 1) {
        var first = lines[0].trim();
        if (/^[A-Z][a-z]+\s+[A-Z][a-z]+(?:\s+[A-Z][a-z]+)?$/.test(first) && first.length < 50) lines[0] = '[NAME]';
        t = lines.join('\n');
      }
      // Explicit race, gender, age, marital status (if ever listed)
      t = t.replace(/\b(?:Male|Female|Non-binary|Man|Woman|M\/F|Gender:)\b/gi, '[REDACTED]');
      t = t.replace(/\b(?:Race|Ethnicity|Nationality)\s*:?\s*[^\n]+/gi, '[REDACTED]');
      t = t.replace(/\b(?:Age|DOB|Date of Birth|Born)\s*:?\s*[\d\-\/\.]+/gi, '[REDACTED]');
      t = t.replace(/\b(?:Married|Single|Marital status)\s*:?\s*[^\n]+/gi, '[REDACTED]');
      // Photos / headshots mention
      t = t.replace(/\b(?:Photo|Headshot|Picture)\s*(?:attached|included)?/gi, '[REDACTED]');
      return t.replace(/\s+/g, ' ')
              .replace(/\s*\[REDACTED\]\s*/g, ' ')
              .replace(/\s*\[DATE\]\s*/g, ' ')
              .replace(/\s*\[DATE RANGE\]\s*/g, ' ')
              .replace(/\s*\[INSTITUTION\]\s*/g, ' ')
              .replace(/\s*\[NAME\]\s*/g, ' ')
              .trim();
    }

    (function resumeUpload() {
      var fileInput = document.getElementById('resume-file');
      var uploadBtn = document.getElementById('upload-resume-btn');
      var fileNameEl = document.getElementById('resume-file-name');
      var statusEl = document.getElementById('resume-scan-status');
      var resultsEl = document.getElementById('resume-scan-results');
      var jobMatchesEl = document.getElementById('resume-job-matches');
      var lastResumeText = null;

      if (!fileInput || !uploadBtn || !fileNameEl || !statusEl || !resultsEl || !jobMatchesEl) return;

      function getMatchBy() {
        var r = document.querySelector('input[name="match-by"]:checked');
        return (r && r.value) || 'experience';
      }

      function refreshJobMatches() {
        if (!lastResumeText) return;
        // Compute matches for both hard skills (resume) and preferences so AI breakdown
        // can show different weights without requiring another upload.
        var matchesResume = computeJobMatches(lastResumeText, 'experience');
        var matchesPrefs = computeJobMatches(lastResumeText, 'interests');

        // Choose which set to render here based on current toggle.
        var modeNow = getMatchBy();
        var activeMatches = modeNow === 'interests' ? matchesPrefs : matchesResume;
        renderJobMatches(jobMatchesEl, activeMatches);

        // Merge both sets into a single list so AI breakdown can see per-job
        // resume vs preferences scores and show all jobs.
        var allResume = (matchesResume.best || []).concat(matchesResume.other || []);
        var allPrefs = (matchesPrefs.best || []).concat(matchesPrefs.other || []);
        var combined = allResume.map(function (jr) {
          var jp = allPrefs.find(function (p) { return p.id === jr.id; }) || { matchPct: 0 };
          return {
            id: jr.id,
            title: jr.title,
            department: jr.department,
            location: jr.location,
            matchPct: jr.matchPct,
            resumePct: jr.matchPct,
            prefsPct: jp.matchPct
          };
        });
        try {
          sessionStorage.setItem('mmJobMatches', JSON.stringify(combined));
          localStorage.setItem('moultrie_resume_job_matches', JSON.stringify(combined));
        } catch (e) {}
      }
      window.refreshJobMatches = refreshJobMatches;

      // If a sanitized resume was previously saved, reuse it so user
      // doesn‚Äôt have to re-upload and it appears under \"My saved profile\".
      try {
        var savedSanitized = localStorage.getItem('moultrie_resume_sanitized');
        var savedAt = localStorage.getItem('moultrie_resume_at');
        if (savedSanitized && savedSanitized.trim()) {
          lastResumeText = savedSanitized;
          statusEl.textContent = '';
          var foundSaved = scanResumeSections(savedSanitized);
          renderScanResults(resultsEl, foundSaved);
          resultsEl.hidden = false;
          refreshJobMatches();
          jobMatchesEl.hidden = false;
        }
      } catch (e) {}

      uploadBtn.addEventListener('click', function () { fileInput.click(); });
      document.querySelectorAll('input[name="match-by"]').forEach(function (radio) {
        radio.addEventListener('change', refreshJobMatches);
      });

      fileInput.addEventListener('change', function () {
        var file = fileInput.files && fileInput.files[0];
        if (!file) return;
        fileNameEl.textContent = 'File: ' + file.name;
        statusEl.textContent = 'Scanning resume‚Ä¶';
        resultsEl.hidden = true;
        jobMatchesEl.hidden = true;

        readResumeText(file).then(function (text) {
          if (!text || !text.trim()) {
            statusEl.textContent = 'Could not extract text from this file. Try a PDF or Word document.';
            return;
          }

          // Sanitize to remove PII and store as part of \"My saved profile\"
          var sanitized = sanitizeResumeForAnalysis(text);
          lastResumeText = sanitized;
          try {
            localStorage.setItem('moultrie_resume_sanitized', sanitized);
            localStorage.setItem('moultrie_resume_at', new Date().toISOString());
            sessionStorage.setItem('mmResumeText', text);
          } catch (e) {}

          var found = scanResumeSections(sanitized);
          statusEl.textContent = 'Scan complete. Key sections detected:';
          renderScanResults(resultsEl, found);
          resultsEl.hidden = false;

          refreshJobMatches();
          jobMatchesEl.hidden = false;
        }).catch(function (err) {
          statusEl.textContent = 'Error: ' + (err && err.message ? err.message : 'Could not read file.');
        });
      });

      function readResumeText(file) {
        var name = (file.name || '').toLowerCase();
        if (name.endsWith('.txt')) {
          return new Promise(function (resolve, reject) {
            var r = new FileReader();
            r.onload = function () { resolve(r.result || ''); };
            r.onerror = function () { reject(new Error('Failed to read file')); };
            r.readAsText(file);
          });
        }
        if (name.endsWith('.pdf')) {
          return file.arrayBuffer().then(function (buf) {
            if (typeof pdfjsLib === 'undefined') return Promise.reject(new Error('PDF library not loaded'));
            return pdfjsLib.getDocument(buf).promise.then(function (pdf) {
              var pages = [];
              for (var i = 1; i <= pdf.numPages; i++) {
                pages.push(pdf.getPage(i).then(function (p) { return p.getTextContent(); }).then(function (c) {
                  return c.items.map(function (it) { return it.str || ''; }).join(' ');
                }));
              }
              return Promise.all(pages).then(function (arr) { return arr.join('\n'); });
            });
          });
        }
        if (name.endsWith('.docx') || name.endsWith('.doc')) {
          return file.arrayBuffer().then(function (buf) {
            if (typeof mammoth === 'undefined') return Promise.reject(new Error('Word library not loaded'));
            return mammoth.extractRawText({ arrayBuffer: buf }).then(function (r) { return r.value; });
          });
        }
        return Promise.reject(new Error('Unsupported format. Use .pdf, .docx, or .txt'));
      }

      var SECTION_DEFS = [
        { id: 'experience', label: 'Job experience', keywords: ['work experience', 'employment', 'professional experience', 'experience', 'career', 'job history', 'employment history', 'work history'] },
        { id: 'projects', label: 'Projects', keywords: ['projects', 'project experience', 'selected projects', 'project work', 'notable projects'] },
        { id: 'leadership', label: 'Leadership', keywords: ['leadership', 'management', 'supervisory', 'team lead', 'manager', 'supervised'] },
        { id: 'activities', label: 'Activities', keywords: ['activities', 'extracurricular', 'volunteer', 'volunteering', 'community', 'clubs', 'organizations'] }
      ];

      var MOULTRIE_JOBS = [
        { title: 'Field Operations Coordinator', department: 'Operations', location: 'Moultrie, GA', skills: ['field operations', 'logistics', 'scheduling', 'coordination', 'inventory', 'documentation', 'safety compliance'], qualifications: ['organization', 'communication', 'problem solving', 'experience in operations', 'teamwork', 'detail oriented'], interests: ['organization', 'hands-on', 'logistics', 'safety', 'procedures', 'teamwork', 'outdoors', 'structure'] },
        { title: 'Customer Success Representative', department: 'Customer Success', location: 'Hybrid', skills: ['customer service', 'customer support', 'phone', 'email', 'CRM', 'troubleshooting', 'onboarding'], qualifications: ['communication', 'empathy', 'problem solving', 'experience with customers', 'listening', 'patience'], interests: ['helping people', 'customer focus', 'listening', 'problem solving', 'teaching', 'relationship building'] },
        { title: 'Technical Project Lead', department: 'Product & Technology', location: 'Remote', skills: ['project management', 'agile', 'scrum', 'technical', 'software', 'development', 'stakeholder', 'timeline', 'budget'], qualifications: ['leadership', 'experience leading projects', 'cross-functional', 'communication', 'organization', 'problem solving'], interests: ['technology', 'leading teams', 'building products', 'strategy', 'collaboration', 'problem solving'] },
        { title: 'HR & Training Specialist', department: 'Human Resources', location: 'Moultrie, GA', skills: ['training', 'onboarding', 'recruiting', 'HR', 'human resources', 'policies', 'orientation', 'development programs'], qualifications: ['communication', 'organization', 'experience in HR', 'facilitation', 'interpersonal', 'confidentiality'], interests: ['teaching', 'helping people grow', 'organization', 'people', 'development', 'culture'] },
        { title: 'Sales & Outreach Associate', department: 'Sales', location: 'Hybrid', skills: ['sales', 'outreach', 'lead generation', 'client', 'pipeline', 'negotiation', 'presentation', 'relationship'], qualifications: ['communication', 'persuasion', 'goal oriented', 'experience in sales', 'networking', 'self motivated'], interests: ['meeting people', 'persuasion', 'goals', 'networking', 'relationship building', 'growth'] },
        { title: 'Operations Manager', department: 'Operations', location: 'On-site', skills: ['operations', 'management', 'process improvement', 'budget', 'planning', 'team leadership', 'KPIs', 'efficiency'], qualifications: ['leadership', 'experience managing', 'analytical', 'decision making', 'organization', 'supervisory'], interests: ['leading', 'efficiency', 'improvement', 'decision making', 'team leadership', 'results'] },
        { title: 'Junior Developer', department: 'Product & Technology', location: 'Remote', skills: ['programming', 'coding', 'software development', 'javascript', 'python', 'web', 'API', 'git', 'debugging'], qualifications: ['problem solving', 'projects', 'computer science', 'technical', 'learning', 'collaboration', 'code'], interests: ['technology', 'building things', 'problem solving', 'learning', 'coding', 'projects', 'creativity'] },
        { title: 'Community Engagement Coordinator', department: 'Community', location: 'Moultrie, GA', skills: ['community', 'engagement', 'outreach', 'events', 'volunteer', 'partnerships', 'social', 'programs'], qualifications: ['communication', 'organization', 'volunteer experience', 'leadership', 'involvement', 'relationship building'], interests: ['community', 'volunteer', 'events', 'helping others', 'partnerships', 'social impact', 'involvement'] }
      ];
      window.MOULTRIE_JOBS = MOULTRIE_JOBS;

      function computeJobMatches(resumeText, matchMode) {
        var normalizedResume = '\n' + (resumeText || '').replace(/\r\n/g, '\n').replace(/\r/g, '\n').toLowerCase();
        var scored = MOULTRIE_JOBS.map(function (job, idx) {
          var allCriteria = matchMode === 'interests' ? (job.interests || []) : (job.skills || []).concat(job.qualifications || []);
          if (allCriteria.length === 0) return { id: idx + 1, title: job.title, department: job.department, location: job.location, matchPct: 0 };
          var matched = 0;
          for (var i = 0; i < allCriteria.length; i++) {
            var phrase = allCriteria[i].toLowerCase().trim();
            if (phrase.length && normalizedResume.indexOf(phrase) !== -1) matched++;
          }
          var pct = Math.round((matched / allCriteria.length) * 100);
          return { id: idx + 1, title: job.title, department: job.department, location: job.location, matchPct: pct };
        });
        scored.sort(function (a, b) { return b.matchPct - a.matchPct; });
        return { best: scored.filter(function (j) { return j.matchPct >= 70; }), other: scored.filter(function (j) { return j.matchPct < 70; }) };
      }

      function renderJobMatches(container, matches) {
        container.innerHTML = '';
        if (matches.best && matches.best.length) {
          var h3Best = document.createElement('h3');
          h3Best.textContent = 'Best matches (70%+)';
          container.appendChild(h3Best);
          var ulBest = document.createElement('ul');
          ulBest.className = 'job-matches-list best-matches';
          matches.best.forEach(function (j) {
            var li = document.createElement('li');
            var titleLink = document.createElement('a');
            titleLink.href = 'job-detail.html?id=' + (j.id || '');
            titleLink.className = 'job-title job-title-link';
            titleLink.textContent = j.title;
            var pctSpan = document.createElement('span');
            pctSpan.className = 'job-pct';
            pctSpan.textContent = j.matchPct + '%';
            li.appendChild(titleLink);
            li.appendChild(pctSpan);
            var likeBtn = document.createElement('button');
            likeBtn.type = 'button';
            likeBtn.className = 'job-like-btn' + (window.isJobLiked && window.isJobLiked(j) ? ' liked' : '');
            likeBtn.textContent = window.isJobLiked && window.isJobLiked(j) ? 'Liked' : 'Like';
            likeBtn.addEventListener('click', function (e) { e.preventDefault(); if (window.toggleJobLike) window.toggleJobLike(j); });
            li.appendChild(likeBtn);
            var meta = document.createElement('div');
            meta.className = 'job-meta';
            meta.textContent = (j.department || '') + ' ¬∑ ' + (j.location || '');
            li.appendChild(meta);
            ulBest.appendChild(li);
          });
          container.appendChild(ulBest);
        }
        if (matches.other && matches.other.length) {
          var h3Other = document.createElement('h3');
          h3Other.textContent = 'Listed jobs';
          container.appendChild(h3Other);
          var ulOther = document.createElement('ul');
          ulOther.className = 'job-matches-list other-jobs';
          matches.other.forEach(function (j) {
            var li = document.createElement('li');
            var titleLink = document.createElement('a');
            titleLink.href = 'job-detail.html?id=' + (j.id || '');
            titleLink.className = 'job-title job-title-link';
            titleLink.textContent = j.title;
            var pctSpan = document.createElement('span');
            pctSpan.className = 'job-pct';
            pctSpan.textContent = j.matchPct + '%';
            li.appendChild(titleLink);
            li.appendChild(pctSpan);
            var likeBtn = document.createElement('button');
            likeBtn.type = 'button';
            likeBtn.className = 'job-like-btn' + (window.isJobLiked && window.isJobLiked(j) ? ' liked' : '');
            likeBtn.textContent = window.isJobLiked && window.isJobLiked(j) ? 'Liked' : 'Like';
            likeBtn.addEventListener('click', function (e) { e.preventDefault(); if (window.toggleJobLike) window.toggleJobLike(j); });
            li.appendChild(likeBtn);
            var meta = document.createElement('div');
            meta.className = 'job-meta';
            meta.textContent = (j.department || '') + ' ¬∑ ' + (j.location || '');
            li.appendChild(meta);
            ulOther.appendChild(li);
          });
          container.appendChild(ulOther);
        }
      }

      function scanResumeSections(text) {
        var normalized = '\n' + (text || '').replace(/\r\n/g, '\n').replace(/\r/g, '\n').toLowerCase();
        return SECTION_DEFS.map(function (def) {
          var found = false;
          var matchedKeyword = null;
          for (var k = 0; k < def.keywords.length; k++) {
            var kw = def.keywords[k].toLowerCase();
            var asHeader = '\n' + kw;
            var withColon = '\n' + kw + ':';
            if (normalized.indexOf(asHeader) !== -1 || normalized.indexOf(withColon) !== -1 || normalized.indexOf(kw) !== -1) {
              found = true;
              matchedKeyword = def.keywords[k];
              break;
            }
          }
          return { id: def.id, label: def.label, found: found, matchedKeyword: matchedKeyword };
        });
      }

      function renderScanResults(container, found) {
        container.innerHTML = '';
        var h3 = document.createElement('h3');
        h3.textContent = 'Sections detected by AI';
        container.appendChild(h3);
        var ul = document.createElement('ul');
        ul.className = 'resume-section-list';
        found.forEach(function (item) {
          var li = document.createElement('li');
          li.className = item.found ? 'found' : 'missing';
          var dot = document.createElement('span');
          dot.className = 'section-dot';
          li.appendChild(dot);
          var label = document.createElement('span');
          label.textContent = item.found ? (item.label + (item.matchedKeyword ? ' (‚Äú' + item.matchedKeyword + '‚Äù)' : '')) : item.label + ' (not detected)';
          li.appendChild(label);
          ul.appendChild(li);
        });
        container.appendChild(ul);
      }
    })();

    function initChat() {
      var AUTO_OPEN_KEY = 'mmChatAutoOpened';
      var panel = document.getElementById('chat-panel');
      var toggle = document.getElementById('chat-toggle');
      var closeBtn = document.getElementById('chat-close');
      var messagesEl = document.getElementById('chat-messages');
      var inputEl = document.getElementById('chat-input');
      var sendBtn = document.getElementById('chat-send');
      if (!panel || !toggle) return;
      var chatState = { lastIntent: null, lastReply: null };

      function openPanel() {
        panel.classList.add('open');
        ensureHello();
        if (inputEl) inputEl.focus();
      }
      function closePanel() {
        panel.classList.remove('open');
      }

      toggle.addEventListener('click', function() {
        if (panel.classList.contains('open')) closePanel();
        else openPanel();
      });
      if (closeBtn) closeBtn.addEventListener('click', closePanel);

      function addMsg(text, isBot) {
        if (!messagesEl) return;
        var div = document.createElement('div');
        div.className = 'chat-msg ' + (isBot ? 'bot' : 'user');
        div.textContent = text;
        messagesEl.appendChild(div);
        messagesEl.scrollTop = messagesEl.scrollHeight;
      }

      function ensureHello() {
        if (!messagesEl) return;
        if (messagesEl.children && messagesEl.children.length) return;
        addMsg("Hey ‚Äî ask me anything about resume upload, matches, the AI breakdown, or the employer dashboard.", true);
        addMsg("If you tell me what you're trying to do (e.g. ‚Äúupload resume‚Äù, ‚Äúsee my top 3 matches‚Äù, ‚Äúopt in to employers‚Äù), I‚Äôll point you to the exact spot.", true);
      }

      function pickAnswer(intentId, answers) {
        if (!answers || !answers.length) return '';
        if (answers.length === 1) return answers[0];
        var start = Math.floor(Math.random() * answers.length);
        for (var i = 0; i < answers.length; i++) {
          var idx = (start + i) % answers.length;
          var candidate = answers[idx];
          if (intentId !== chatState.lastIntent || candidate !== chatState.lastReply) return candidate;
        }
        return answers[0];
      }

      function getBotReply(userText) {
        var t = (userText || '').toLowerCase().trim().replace(/\s+/g, ' ');
        if (!t) return "Type a question and I'll try to help.";

        var KB = [
          { id: 'greeting', patterns: [/^(hi|hello|hey|howdy)\b/, /\bgood (morning|afternoon|evening)\b/], answers: [
            "Hey ‚Äî ask me anything about resume upload, matches, the AI breakdown, or the employer dashboard.",
            "Hi. Tell me what you‚Äôre trying to do and I‚Äôll point you to the exact spot in the app."
          ]},
          { id: 'start', patterns: [/\bwhere do i start\b/, /\bhow do i start\b/, /\bwhat do i do\b/], answers: [
            "Start: (1) Home ‚Üí ‚ÄúI‚Äôm a prospective employee‚Äù, (2) ‚ÄúUpload Resume‚Äù, (3) ‚ÄúPersonalized Questions‚Äù, (4) open ‚ÄúAI Decision Breakdown‚Äù.",
            "Fast path: upload resume ‚Üí answer personalized questions ‚Üí open AI Decision Breakdown for the top 3 + the why."
          ]},
          { id: 'upload_where', patterns: [/\bwhere .*upload\b/, /\bupload (my )?resume\b/, /\badd (my )?resume\b/], answers: [
            "Home ‚Üí ‚ÄúI‚Äôm a prospective employee‚Äù ‚Üí ‚ÄúUpload Resume‚Äù. Paste text or upload a PDF/.txt.",
            "Prospective employee ‚Üí ‚ÄúUpload Resume‚Äù. Paste is fine too."
          ]},
          { id: 'upload_formats', patterns: [/\bfile (type|format)\b/, /\b(pdf|\.pdf)\b/, /\b(txt|\.txt)\b/, /\bcan i paste\b/, /\bpaste (my )?resume\b/], answers: [
            "Supported: PDF, .txt, or pasted text.",
            "PDF or .txt works, and you can also paste your resume text directly into the box."
          ]},
          { id: 'resume_usage', patterns: [/\bwhat.*use.*resume\b/, /\bresume (analysis|analyze)\b/, /\bwhat do you extract\b/], answers: [
            "We use skills, experience, and qualifications. We strip PII and bias-adjacent signals (name/contact/location/school/dates/etc.).",
            "Only job-relevant content (skills/experience/quals) is used. Identifying info gets redacted before scoring."
          ]},
          { id: 'pii', patterns: [/\bpii\b/, /\bredact\b/, /\bremove (my )?(name|email|phone|address|location)\b/, /\bpersonal information\b/], answers: [
            "Yep ‚Äî we redact name, email/phone, address/location, school names, graduation dates, and demographic info before matching.",
            "We strip identifying + bias-inducing details first, then score on skills/experience/fit."
          ]},
          { id: 'matches_how', patterns: [/\b(job )?matches\b/, /\brecommendations\b/, /\bbest matches\b/, /\btop (3|three)\b/], answers: [
            "Upload resume + complete Personalized Questions. Then open ‚ÄúAI Decision Breakdown‚Äù to see your top 3 and the breakdown.",
            "Matches appear after resume + questions. The breakdown page shows the ‚Äòwhy‚Äô."
          ]},
          { id: 'liked', patterns: [/\bliked jobs\b/, /\bfavorit(e|es)\b/, /\bsave (a )?job\b/, /\bbookmark\b/], answers: [
            "Use ‚ÄúLiked jobs‚Äù under the Prospective employee options.",
            "Saved roles show up under ‚ÄúLiked jobs‚Äù."
          ]},
          { id: 'apply', patterns: [/\bapply\b/, /\bapplication process\b/, /\bsubmit application\b/], answers: [
            "This dashboard is for matching + transparency. Applying happens through the standard internal hiring flow for that role.",
            "Use this tool to understand fit; then apply via the normal HR/job-posting process."
          ]},
          { id: 'employer_dash', patterns: [/\bemployer dashboard\b/, /\bhiring manager\b/, /\bsee candidates\b/], answers: [
            "Home ‚Üí ‚ÄúI‚Äôm an employer‚Äù ‚Üí ‚ÄúOpen employer dashboard‚Äù. Only opted-in candidates show.",
            "Employer view is separate: open the Employer dashboard; only opted-in profiles appear there."
          ]},
          { id: 'visibility', patterns: [/\bwho can see me\b/, /\bvisible to employers\b/, /\bopt ?in\b/, /\bemployer(s)? see\b/], answers: [
            "By default you‚Äôre not visible. If you opt in, your profile can appear on the Employer dashboard.",
            "Opt-in controls visibility. No opt-in = employers don‚Äôt see you here."
          ]},
          { id: 'personalized', patterns: [/\bpersonalized questions\b/, /\bchange (my )?answers\b/, /\bedit (my )?preferences\b/, /\bworking style\b/], answers: [
            "Personalized Questions captures work mode, traits, priorities, etc. Submit again anytime to update.",
            "Update your answers by resubmitting Personalized Questions ‚Äî that feeds the fit scoring."
          ]},
          { id: 'weighting', patterns: [/\bweight\b/, /\bweigh\b/, /\bresume vs\b/, /\bhard skills\b/, /\bpreferences mode\b/], answers: [
            "On AI Decision Breakdown you can switch between ‚ÄúResume & hard skills‚Äù vs ‚ÄúMy answers & preferences‚Äù. The bar charts update immediately.",
            "Use the weighting toggle on the breakdown page to decide what matters more (resume vs preferences)."
          ]},
          { id: 'breakdown', patterns: [/\bai\b.*\bbreakdown\b/, /\bdecision breakdown\b/, /\bwhy (this|that) job\b/, /\bexplain (the )?score\b/], answers: [
            "AI Decision Breakdown shows weights + factor contributions (bars), and your top 3 jobs each with a pie breakdown (skills/experience/fit).",
            "Open ‚ÄúAI Decision Breakdown‚Äù to see exactly how the score was built."
          ]},
          { id: 'privacy', patterns: [/\bprivacy\b/, /\bstore\b/, /\bkeep\b/, /\bdelete\b/, /\bforget\b/], answers: [
            "Employer visibility is opt-in. Resume text is sanitized before analysis. You can clear browser storage to wipe saved state.",
            "Privacy-wise: PII is redacted; opt-in controls employer visibility; clearing site data removes stored state."
          ]},
          { id: 'bias', patterns: [/\bbias\b/, /\bfair(ness)?\b/, /\bunbiased\b/, /\bdiscrimination\b/], answers: [
            "We reduce bias via redaction + transparency: strip identifiers, then show factor contributions in the breakdown.",
            "Bias mitigation here is primarily removing PII/demographic signals before scoring."
          ]},
          { id: 'training', patterns: [/\btraining\b/, /\bcourses?\b/, /\blearning\b/, /\bdevelopment\b/], answers: [
            "Check ‚ÄúTraining & Courses Match‚Äù under Prospective employee options.",
            "Training suggestions live under ‚ÄúTraining & Courses Match‚Äù."
          ]},
          { id: 'about', patterns: [/\babout\b/, /\bmoultrie\b/, /\bwhat is this\b/, /\bwho is this for\b/, /\binternal\b/], answers: [
            "This is Moultrie Mobile‚Äôs internal career match dashboard (employees + hiring managers). About page has company/product context.",
            "Internal tool: match people to roles, then explain the scoring. About page covers Moultrie Mobile."
          ]},
          { id: 'comp', patterns: [/\bsalary\b/, /\bpay\b/, /\bcompensation\b/, /\bbenefits\b/], answers: [
            "This tool doesn‚Äôt include comp/benefits details ‚Äî that‚Äôs in the role posting/HR channel.",
            "Comp/benefits aren‚Äôt modeled here. Use the official role listing or HR."
          ]},
          { id: 'remote', patterns: [/\bremote\b/, /\bhybrid\b/, /\b(on[ -]?site|in[- ]person)\b/, /\bwork from home\b/, /\blocation\b/], answers: [
            "Set your work-mode preference in Personalized Questions (remote/hybrid/in-person/flexible).",
            "Work mode is captured in Personalized Questions and used to adjust matches."
          ]},
          { id: 'improve', patterns: [/\blow score\b/, /\bimprove\b/, /\bbetter match\b/, /\bwhy (is|so) low\b/], answers: [
            "Use the breakdown to see what‚Äôs dragging the score (skills vs experience vs fit), then update resume or preferences accordingly.",
            "If a match is low, it‚Äôs usually missing skills/experience signals or a preference conflict. The breakdown shows which."
          ]}
        ];

        function scoreIntent(item) {
          var score = 0;
          for (var i = 0; i < item.patterns.length; i++) {
            if (item.patterns[i].test(t)) score += 10;
          }
          if (score) score += Math.min(10, Math.floor(t.length / 15));
          return score;
        }

        var best = null;
        var bestScore = 0;
        for (var i = 0; i < KB.length; i++) {
          var s = scoreIntent(KB[i]);
          if (s > bestScore) { bestScore = s; best = KB[i]; }
        }

        if (best && bestScore > 0) {
          var reply = pickAnswer(best.id, best.answers);
          chatState.lastIntent = best.id;
          chatState.lastReply = reply;
          return reply;
        }

        return "Tell me what you‚Äôre trying to do (upload resume, see matches, AI breakdown, employer visibility) and I‚Äôll point you to the exact step.";
      }

      function sendMessage() {
        var text = (inputEl && inputEl.value || '').trim();
        if (!text) return;
        if (inputEl) inputEl.value = '';
        addMsg(text, false);
        var reply = getBotReply(text);
        setTimeout(function() { addMsg(reply, true); }, 300);
      }

      if (sendBtn) sendBtn.addEventListener('click', function(e) { e.preventDefault(); sendMessage(); });
      if (inputEl) {
        inputEl.addEventListener('keydown', function(e) {
          if (e.key === 'Enter') { e.preventDefault(); sendMessage(); }
        });
      }

      function maybeAutoOpen() {
        try {
          if (!sessionStorage.getItem(AUTO_OPEN_KEY)) {
            sessionStorage.setItem(AUTO_OPEN_KEY, '1');
            openPanel();
          }
        } catch (err) {}
      }
      if (document.readyState === 'complete') setTimeout(maybeAutoOpen, 100);
      else window.addEventListener('load', maybeAutoOpen);
    }
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initChat);
    } else {
      initChat();
    }

    (function () {
      var contactBlock = document.getElementById('save-name-contact');
      var yesRadio = document.getElementById('save-name-yes');
      var noRadio = document.getElementById('save-name-no');
      function toggleContact() {
        if (!contactBlock) return;
        contactBlock.style.display = (yesRadio && yesRadio.checked) ? 'block' : 'none';
      }
      if (yesRadio) yesRadio.addEventListener('change', toggleContact);
      if (noRadio) noRadio.addEventListener('change', toggleContact);
      toggleContact();
    })();

    function prefillPersonalizedForm() {
      try {
        var raw = localStorage.getItem('moultrie_personalized');
        if (!raw) return;
        var answers = JSON.parse(raw);
        var form = document.getElementById('personalized-form');
        if (!form) return;

        // Pre-fill radio buttons
        ['work-mode', 'employment-type', 'start-date', 'team-size', 'relocate', 'save-name'].forEach(function(name) {
          if (answers[name]) {
            var value = [].concat(answers[name])[0];
            var input = form.querySelector('input[name="' + name + '"][value="' + value + '"]');
            if (input) input.checked = true;
          }
        });

        // Pre-fill checkboxes
        ['priorities', 'traits', 'sectors'].forEach(function(name) {
          if (answers[name]) {
            var values = [].concat(answers[name]).filter(Boolean);
            values.forEach(function(value) {
              var input = form.querySelector('input[name="' + name + '"][value="' + value + '"]');
              if (input) input.checked = true;
            });
          }
        });

        // Pre-fill text inputs
        if (answers['profile_name']) {
          var nameInput = document.getElementById('profile-name');
          if (nameInput) nameInput.value = answers['profile_name'];
        }
        if (answers['profile_email']) {
          var emailInput = document.getElementById('profile-email');
          if (emailInput) emailInput.value = answers['profile_email'];
        }
        if (answers['anything_else']) {
          var textarea = document.getElementById('anything-else');
          if (textarea) textarea.value = answers['anything_else'];
        }

        // Show contact fields if save-name is yes
        if (answers['save-name'] === 'yes') {
          var contactDiv = document.getElementById('save-name-contact');
          if (contactDiv) contactDiv.style.display = 'block';
        }
      } catch (e) {
        console.warn('Could not pre-fill form:', e);
      }
    }

    document.getElementById('personalized-form')?.addEventListener('submit', function(e) {
      e.preventDefault();
      const data = new FormData(this);
      const out = {};
      for (const [k, v] of data.entries()) {
        if (!v) continue;
        if (out[k] === undefined) out[k] = v;
        else out[k] = [].concat(out[k], v);
      }
      var saveName = [].concat(out['save-name'] || []).filter(Boolean)[0];
      if (saveName === 'yes') {
        var profileName = (out['profile_name'] || '').toString().trim();
        var profileEmail = (out['profile_email'] || '').toString().trim();
        if (!profileName || !profileEmail) {
          alert('Please enter your name and email so we can save your profile for employers.');
          return;
        }
      }
      if (saveName !== 'yes') {
        try {
          localStorage.removeItem('moultrie_personalized');
          localStorage.removeItem('moultrie_personalized_at');
          // Set visibility to private if they chose no
          if (saveName === 'no') {
            localStorage.setItem('moultrie_visible_to_employers', 'private');
          }
        } catch (err) { console.warn(err); }
        if (saveName === 'no') {
          alert('Your profile was not saved. Your answers will not be stored or shared with employers. You can change your answer above and save again if you\'d like your preferences used for matching.');
          // Refresh saved profile if we're on that page
          if (location.hash === '#my-progress') {
            try { renderSavedProfile(); } catch (e) {}
          }
        } else {
          alert('Please choose whether we may use your name to save your profile (Yes or No) before saving.');
        }
        return;
      }
      try {
        localStorage.setItem('moultrie_personalized', JSON.stringify(out));
        localStorage.setItem('moultrie_personalized_at', new Date().toISOString());
        // Save visibility preference
        localStorage.setItem('moultrie_visible_to_employers', saveName === 'yes' ? 'public' : 'private');
      } catch (err) { console.warn('Could not save to localStorage:', err); }

      var OPTED_IN_KEY = 'moultrie_opted_in_candidates';
      var profileName = (out['profile_name'] || '').toString().trim();
      var profileEmail = (out['profile_email'] || '').toString().trim();
      var role = 'General candidate';
      var match = 0;
      var sectors = [].concat(out.sectors || []).filter(Boolean);
      if (sectors.length) {
        var labels = { tech: 'Tech & IT', operations: 'Operations', hr: 'HR & People', finance: 'Finance', sales: 'Sales & Marketing', engineering: 'Engineering' };
        role = (labels[sectors[0]] || sectors[0]) + ' candidate';
      }
      var bestJobTitle = '';
      var jobMatches = [];
      try {
        var matches = sessionStorage.getItem('mmJobMatches') || localStorage.getItem('moultrie_resume_job_matches');
        if (matches) {
          var arr = JSON.parse(matches);
          if (arr && arr.length) {
            var first = arr[0];
            var pct0 = first.matchPct != null ? first.matchPct : (first.match != null ? first.match : (first.overall != null ? first.overall : 0));
            if (typeof pct0 === 'number') match = pct0;
            if (first.title) bestJobTitle = first.title;
            jobMatches = arr.map(function (j) {
              var p = j.matchPct != null ? j.matchPct : (j.match != null ? j.match : (j.overall != null ? j.overall : 0));
              return { title: j.title, matchPct: typeof p === 'number' ? p : 0 };
            });
          }
        }
      } catch (err) {}
      var resumeText = '';
      try {
        var raw = sessionStorage.getItem('mmResumeText') || localStorage.getItem('moultrie_resume_text') || '';
        resumeText = (raw && raw.length) ? (raw.length > 80000 ? raw.slice(0, 80000) : raw) : '';
      } catch (e) {}
      try {
        var list = [];
        try { list = JSON.parse(localStorage.getItem(OPTED_IN_KEY) || '[]'); } catch (e) {}
        list = list.filter(function (c) { return (c.email || '').toLowerCase() !== profileEmail.toLowerCase(); });
        list.push({
          name: profileName,
          email: profileEmail,
          phone: '',
          role: role,
          match: match,
          bestJobTitle: bestJobTitle,
          jobMatches: jobMatches,
          resumeText: resumeText,
          jobKey: 'general',
          public: true,
          diagnostic: { sectors: out.sectors, workMode: out['work-mode'], traits: out.traits, priorities: out.priorities }
        });
        localStorage.setItem(OPTED_IN_KEY, JSON.stringify(list));
      } catch (err) { console.warn('Could not add to employer list:', err); }

      alert('Thanks! Your answers have been saved. They\'ll be used when we analyze which roles suit you best. Your profile will appear for employers when they view the dashboard.');
      
      // Refresh saved profile if we're on that page
      if (location.hash === '#my-progress') {
        try { renderSavedProfile(); } catch (e) {}
      }
    });

    // (Removed) Extra bias-free resume upload flow used by #upload-resume-paste
  </script>
</body>
</html>
